{"config":{"lang":["en"],"separator":"[\\s\\-]+","pipeline":["stopWordFilter"],"fields":{"title":{"boost":1000.0},"text":{"boost":1.0},"tags":{"boost":1000000.0}}},"docs":[{"location":"","title":"Stata-MCP","text":"<p>Let LLM help you achieve your regression with Stata.</p> <p>Statement: All the documents are generated by AI, except Usage.md which is written by the author.</p>"},{"location":"#quickly-start","title":"Quickly Start","text":"<p>Requirements: uv or python 3.11+ If you don't have <code>uv</code> but <code>python</code>, you can install it with <code>pip install uv</code>.  </p> <p>First, you should check whether your device is supported by stata-mcp.  </p> <pre><code>uvx stata-mcp --usable\n</code></pre> <p>If each check is passed, you can start using stata-mcp. If remind not found STATA_CLI, you can see StataFinder to solve it.</p> <p>The common configuration file (json)</p> <pre><code>{\n  \"mcpServers\":{\n    \"stata-mcp\": {\n      \"command\": \"uvx\",\n      \"args\": [\"stata-mcp\"]\n    }\n  }\n}\n</code></pre>"},{"location":"#use-stata-mcp-in-claude-code","title":"Use Stata-MCP in Claude Code","text":"<p>We recommend using Stata-MCP with Claude Code for its excellent agentic capabilities.</p> <p>Before using it, please make sure you have Claude Code installed. If you don't know how to install it, visit GitHub.</p> <p>Open your terminal, <code>cd</code> to your working directory, and run:</p> <pre><code>claude mcp add stata-mcp --env STATA_MCP_CWD=$(pwd) --scope project -- uvx --directory $(pwd) stata-mcp\n</code></pre> <p>This will create a <code>.mcp.json</code> file in your working directory with the MCP configuration.</p>"},{"location":"#use-cases","title":"Use Cases","text":"<ul> <li>Paper Replication: Replicate empirical studies from economics papers</li> <li>Quick Hypothesis Testing: Validate economic hypotheses through regression analysis</li> <li>Stata Learning Assistant: Learn econometrics with step-by-step Stata explanations</li> <li>Code Organization: Review and optimize existing Stata do-files</li> <li>Result Interpretation: Understand complex statistical outputs and regression results</li> </ul> <p>For detailed usage guide, visit agents/claude_code.md.</p> <p>If you want to explore more clients or agents, visit their respective documentation.</p>"},{"location":"#documentation","title":"Documentation","text":""},{"location":"#core-documentation","title":"Core Documentation","text":"<ul> <li>Overview: Architecture, design philosophy, and integration patterns</li> <li>Usage: Common usage patterns and examples</li> <li>Configuration: Complete configuration guide with all options</li> <li>Clients: Supported MCP clients and setup instructions</li> <li>Claude Plugin: Official Claude Code plugin integration guide</li> </ul>"},{"location":"#advanced-features","title":"Advanced Features","text":"<ul> <li>Security Guard: Security validation system for dangerous commands</li> <li>Monitoring System: RAM monitoring and resource limits</li> </ul>"},{"location":"#core-components","title":"Core Components","text":"<ul> <li>Stata Integration</li> <li>StataDo: Do-file execution</li> <li>StataFinder: Stata executable detection</li> <li>Stata Help: Command documentation</li> <li> <p>Package Installation: SSC and GitHub packages</p> </li> <li> <p>MCP Tools: Available MCP tools and usage</p> </li> <li>MCP Resources: MCP resources and capabilities</li> </ul>"},{"location":"#agents","title":"Agents","text":"<ul> <li>Agent Index: Overview of agent modes</li> <li>Claude Code Integration: Detailed Claude Code setup</li> </ul>"},{"location":"#quick-links","title":"Quick Links","text":""},{"location":"#for-users","title":"For Users","text":"<ul> <li>Getting Started</li> <li>Configuration Guide</li> <li>Security Documentation</li> <li>Monitoring Setup</li> </ul>"},{"location":"#for-developers","title":"For Developers","text":"<ul> <li>Architecture Overview</li> <li>MCP Tools Reference</li> <li>Core Components</li> </ul>"},{"location":"#configuration","title":"Configuration","text":"<ul> <li>Basic Configuration</li> <li>Security Settings</li> <li>Monitoring Settings</li> <li>Environment Variables</li> </ul>"},{"location":"claude-plugin/","title":"Claude Plugin Integration","text":""},{"location":"claude-plugin/#overview","title":"Overview","text":"<p>Stata-MCP provides official native plugin support for Claude Code, integrating two powerful components in <code>stata-toolbox@stata-plugin-lib</code> now:</p> <ol> <li>Stata-MCP Server: Model Context Protocol server for Stata execution</li> <li>Stata LSP (Language Server Protocol): Advanced language support for Stata do-files</li> </ol> <p>This plugin package, named stata-toolbox, delivers a unified development environment for empirical research, combining the analytical power of Stata with AI assistance and advanced IDE features.</p>"},{"location":"claude-plugin/#what-is-claude-plugin","title":"What is Claude Plugin?","text":"<p>Claude Plugin is a plugin system introduced in Claude Code that allows developers to package and distribute:</p> <ul> <li>MCP Servers: Model Context Protocol servers that expose tools to Claude</li> <li>LSP Servers: Language Server Protocol servers for enhanced editor support</li> <li>Skills: Skills for expand Claude agent abilities</li> <li>Configuration: Pre-configured settings for optimal integration</li> </ul> <p>The plugin system enables one-command installation of complex development environments, replacing manual configuration with reproducible, version-controlled packages.</p>"},{"location":"claude-plugin/#plugin-structure","title":"Plugin Structure","text":"<p>More plugin config schema could be found in plugins-reference from Claude. </p> <pre><code>.claude-plugin/\n\u251c\u2500\u2500 marketplace.json          # Plugin registry manifest\n\u2514\u2500\u2500 plugins/\n    \u2514\u2500\u2500 stata-toolbox/       # Plugin package\n        \u2514\u2500\u2500 plugin.json        # Plugin configuration\n</code></pre>"},{"location":"claude-plugin/#marketplace-manifest-marketplacejson","title":"Marketplace Manifest (<code>marketplace.json</code>)","text":"<pre><code>{\n  \"name\": \"stata-plugin-lib\",\n  \"owner\": {\n    \"name\": \"Song Tan\",\n    \"email\": \"sepinetam@gmail.com\"\n  },\n  \"plugins\": [\n    {\n      \"name\": \"stata-toolbox\",\n      \"source\": \"./plugins/stata-toolbox\",\n      \"description\": \"The official working package of Stata-MCP plugin, including mcp config and stata lsp.\"\n    }\n  ]\n}\n</code></pre> <p>Fields: - <code>name</code> (string): Marketplace library identifier (kebab-case, no spaces) - <code>owner</code> (object): Author information   - <code>name</code> (string): Author name   - <code>email</code> (string): Contact email - <code>plugins</code> (array): List of plugin packages   - <code>name</code> (string): Plugin identifier   - <code>source</code> (string): Relative path to plugin directory   - <code>description</code> (string): Plugin functionality summary</p>"},{"location":"claude-plugin/#plugin-configuration-pluginjson","title":"Plugin Configuration (<code>plugin.json</code>)","text":"<pre><code>{\n  \"name\": \"stata-toolbox\",\n  \"version\": \"0.1.0\",\n  \"description\": \"The official working package of Stata-MCP plugin, including mcp config and stata lsp.\",\n  \"author\": {\n    \"name\": \"Song Tan\",\n    \"email\": \"sepinetam@gmail.com\",\n    \"url\": \"https://www.sepinetam.com\"\n  },\n  \"homepage\": \"https://statamcp.com\",\n  \"repository\": \"https://github.com/sepinetam/stata-mcp\",\n  \"license\": \"AGPL-3.0\",\n  \"keywords\": [\"stata\", \"econometrics\", \"empirical analysis\"],\n  \"mcpServers\": {\n    ...\n  },\n  \"lspServers\": {\n    ...\n  }\n}\n</code></pre> <p>Configuration Sections:</p>"},{"location":"claude-plugin/#mcp-servers-configuration","title":"MCP Servers Configuration","text":"<pre><code>{\n  \"mcpServers\": {\n    \"stata-mcp\": {\n      \"command\": \"uvx\", \n      \"args\": [\n        \"stata-mcp\"\n      ]\n    }\n  }\n}\n</code></pre> <p>command: The command to execute the MCP server. Using <code>uvx</code> allows running installed Python packages directly without activating a virtual environment.</p> <p>args: Array of command-line arguments passed to the command. <code>[\"stata-mcp\"]</code> specifies the package name to run.</p>"},{"location":"claude-plugin/#lsp-servers-configuration","title":"LSP Servers Configuration","text":"<pre><code>\"lspServers\": {\n  \"stata\": {\n    \"command\": \"stata-language-server\",\n    \"args\": [],\n    \"extensionToLanguage\": {\n      \".do\": \"stata\"\n    },\n    \"settings\": {\n      \"stata\": {\n        \"setMaxLineLength\": 120,\n        \"setIndentSpace\": 4,\n        \"enableCompletion\": true,\n        \"enableDocstring\": true,\n        \"enableStyleChecking\": true,\n        \"enableFormatting\": true\n      }\n    }\n  }\n}\n</code></pre> <p>Notes: You should install <code>stata-language-server</code> first via <code>pipx install \"git+https://github.com/euglevi/stata-language-server.git\"</code>. </p> <p>command: The LSP server binary executable. Must be available in the system PATH.</p> <p>args: Array of command-line arguments passed to the LSP server. Empty array means no additional arguments.</p> <p>extensionToLanguage: Maps file extensions to language identifiers. <code>.do</code> files are mapped to the <code>stata</code> language for proper LSP support.</p> <p>settings: LSP-specific configuration object. The <code>stata</code> key contains Stata language server settings for code completion, formatting, and style checking.</p>"},{"location":"claude-plugin/#installation","title":"Installation","text":""},{"location":"claude-plugin/#prerequisites","title":"Prerequisites","text":"<p>Before installing the plugin, ensure following requirements are met:</p> <ol> <li>Claude Code: Install via official installer    ```bash    # macOS/Linux    curl -fsSL https://claude.ai/install.sh | bash</li> </ol> <p># Windows    irm https://claude.ai/install.ps1 | iex    ```</p> <ol> <li> <p>Stata: Valid Stata 17+ license with Stata MP installed</p> </li> <li> <p>Python Package: <code>stata-mcp</code> package available    <code>bash    # Verify installation    uvx stata-mcp --usable</code></p> </li> <li> <p>Stata LSP: Language server installed    <code>bash    pipx install \"git+https://github.com/euglevi/stata-language-server.git\"</code></p> </li> <li> <p>uv: Package runner (recommended)    ```bash    # Install via homebrew    brew install uv</p> </li> </ol> <p># Or via official installer    curl -LsSf https://astral.sh/uv/install.sh | sh    ```</p>"},{"location":"claude-plugin/#installation-method","title":"Installation Method","text":"<p>Add the marketplace registry and install the plugin:</p> <pre><code># Add marketplace\nclaude plugin marketplace add sepinetam/stata-mcp\n\n# Install plugin to user scope (default)\nclaude plugin install stata-toolbox\n\n# Install to project scope (shared with team)\nclaude plugin install stata-toolbox --scope project\n\n# Install to local scope (gitignored)\nclaude plugin install stata-toolbox --scope local\n</code></pre> <p>The plugin automatically uses the current directory as the working directory for Stata operations.</p>"},{"location":"claude-plugin/#verification","title":"Verification","text":"<p>After installation, verify the plugin is loaded:</p> <pre><code># List installed plugins\nclaude plugin list\n</code></pre>"},{"location":"claude-plugin/#how-it-works","title":"How It Works","text":"<p>Once installed, the plugin provides seamless integration:</p> <p>1. Automatic Loading Claude Code automatically detects: - <code>.claude-plugin/marketplace.json</code> \u2192 Plugin registry - <code>plugins/stata-toolbox/plugin.json</code> \u2192 Plugin configuration</p> <p>2. MCP Tools The Stata-MCP server exposes tools that Claude can invoke: - <code>stata_do</code>: Execute Stata code - <code>write_dofile</code>: Create do-files - <code>get_data_info</code>: Analyze datasets - <code>help</code>: Get Stata command documentation - And more...</p> <p>3. LSP Features The Stata LSP provides advanced editor support: - Syntax Highlighting: Enhanced .do file coloring - Completion: Auto-suggest Stata commands - Hover Documentation: Mouse over commands for help - Error Detection: Real-time syntax validation - Formatting: Auto-format .do files</p>"},{"location":"claude-plugin/#example-workflows","title":"Example Workflows","text":"<p>This part is generated by AI, please review before use. If you want to achieve the best results, you should edit your <code>~/.claude/CLAUDE.md</code> with your own preferences. </p>"},{"location":"claude-plugin/#paper-replication","title":"Paper Replication","text":"<pre><code>&gt; Load the dataset from \"source/data/CPS_2018.dta\"\n&gt; Replicate Table 3 from Mincer (1974) using OLS regression\n&gt; Export the regression table to LaTeX format\n\nClaude:\n1. Uses get_data_info to understand dataset structure\n2. Creates do-file with write_dofile\n3. Executes with stata_do\n4. Exports table to stata-mcp-result/\n</code></pre>"},{"location":"claude-plugin/#quick-hypothesis-testing","title":"Quick Hypothesis Testing","text":"<pre><code>&gt; Test whether education returns have increased post-2008 financial crisis\n&gt; Use difference-in-differences with college enrollment as treatment\n\nClaude:\n1. Generates DiD specification\n2. Runs stata_do with event study design\n3. Presents results with economic interpretation\n</code></pre>"},{"location":"claude-plugin/#comparison-plugin-vs-manual-configuration","title":"Comparison: Plugin vs Manual Configuration","text":""},{"location":"claude-plugin/#manual-configuration","title":"Manual Configuration","text":"<p>Traditional approach with command:</p> <pre><code>claude mcp add stata-mcp -- uvx stata-mcp\n</code></pre> <p>or requires manual <code>.mcp.json</code> editing:</p> <pre><code>{\n  \"mcpServers\": {\n    \"stata-mcp\": {\n      \"command\": \"uvx\",\n      \"args\": [\"stata-mcp\"],\n      \"env\": {\n        \"STATA_MCP_CWD\": \"/absolute/path/to/project\"\n      }\n    }\n  }\n}\n</code></pre>"},{"location":"claude-plugin/#plugin-based-configuration","title":"Plugin-Based Configuration","text":"<p>With Plugin:</p> <pre><code># Single command installation\nclaude plugin marketplace add sepinetam/stata-mcp\nclaude plugin install stata-toolbox\n</code></pre>"},{"location":"claude-plugin/#comparison","title":"Comparison","text":"Feature Manual Configuration Plugin Installation Setup Edit <code>.mcp.json</code> manually or command One-command installation MCP Server \u2705 \u2705 LSP Server \u274c Separate installation \u2705 Included Team Sharing \u2705 \u2705 Updates Auto update the latest MCP Auto update MCP and manual update others"},{"location":"claude-plugin/#architecture","title":"Architecture","text":""},{"location":"claude-plugin/#plugin-loading-process","title":"Plugin Loading Process","text":"<pre><code>1. Claude Code Startup\n   \u2193\n2. Scan for .claude-plugin/marketplace.json\n   \u2193\n3. Parse plugin registry\n   \u2193\n4. Load each plugin's plugin.json\n   \u2193\n5. Register MCP servers\n   \u2193\n6. Initialize LSP servers\n   \u2193\n7. Apply plugin configurations\n   \u2193\n8. Plugin ready for use\n</code></pre>"},{"location":"claude-plugin/#component-interaction","title":"Component Interaction","text":"<pre><code>\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n\u2502                   Claude Code                       \u2502\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n                       \u2502\n         \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2534\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n         \u2502                          \u2502\n    \u250c\u2500\u2500\u2500\u2500\u25bc\u2500\u2500\u2500\u2500\u2500\u2510                \u250c\u2500\u2500\u2500\u2500\u25bc\u2500\u2500\u2500\u2500\u2500\u2510\n    \u2502   MCP    \u2502                \u2502   LSP    \u2502\n    \u2502  Server  \u2502                \u2502  Server  \u2502\n    \u2514\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u2518                \u2514\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u2518\n         \u2502                           \u2502\n    \u250c\u2500\u2500\u2500\u2500\u25bc\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u25bc\u2500\u2500\u2500\u2500\u2510\n    \u2502         Stata-MCP Package           \u2502\n    \u2502  - stata_do tool                    \u2502\n    \u2502  - Data analysis tools              \u2502\n    \u2502  - Help system                      \u2502\n    \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n         \u2502\n    \u250c\u2500\u2500\u2500\u2500\u25bc\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n    \u2502     Stata     \u2502\n    \u2502  Executable   \u2502\n    \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n</code></pre>"},{"location":"claude-plugin/#troubleshooting","title":"Troubleshooting","text":""},{"location":"claude-plugin/#plugin-not-detected","title":"Plugin Not Detected","text":"<p>Symptom: Plugin installed but Claude Code doesn't show tools</p> <p>Solutions: 1. Restart Claude Code completely 2. Verify JSON syntax in marketplace.json and plugin.json 3. Check file permissions (must be readable) 4. Ensure plugin is installed correctly 5. Run <code>claude plugin list</code> to verify</p>"},{"location":"claude-plugin/#mcp-server-connection-failed","title":"MCP Server Connection Failed","text":"<p>Symptom: Tools show error \"Failed to connect to MCP server\"</p> <p>Diagnosis:</p> <pre><code># Test MCP server independently\nuvx stata-mcp --usable\n\n# Check if Stata is accessible\nstata-se --version\n\n# Verify uvx installation\nuvx --version\n</code></pre> <p>Solutions: 1. Install missing dependencies:    <code>bash    pip install stata-mcp</code></p> <ol> <li> <p>Verify Stata installation path</p> </li> <li> <p>Check environment variables are correctly set</p> </li> </ol>"},{"location":"claude-plugin/#lsp-not-working","title":"LSP Not Working","text":"<p>Symptom: No syntax highlighting or completion in .do files</p> <p>Diagnosis:</p> <pre><code># Check if stata-language-server is installed\nwhich stata-language-server\n\n# Test LSP server\nstata-language-server --help\n</code></pre> <p>Solutions: 1. Install stata-language-server:    <code>bash    npm install -g stata-language-server</code></p> <ol> <li> <p>Verify file extension mapping:    <code>json    {      \"extensionToLanguage\": {        \".do\": \"stata\"      }    }</code></p> </li> <li> <p>Check LSP logs in Claude Code</p> </li> </ol>"},{"location":"claude-plugin/#best-practices","title":"Best Practices","text":"<ol> <li>Verify Installation: Check system compatibility with <code>uvx stata-mcp --usable</code> before installing</li> <li>Environment Variables: Use <code>.env</code> file or project settings for sensitive data</li> <li>Documentation: Maintain project-specific CLAUDE.md with research instructions</li> <li>Version Updates: Keep plugin updated for latest features and bug fixes</li> </ol>"},{"location":"claude-plugin/#related-documentation","title":"Related Documentation","text":"<ul> <li>Configuration Guide - Advanced configuration options</li> <li>Security Documentation - Security guard system</li> <li>Monitoring Guide - Resource monitoring</li> <li>MCP Tools Reference - Available tools</li> <li>Usage Examples - Common workflows</li> <li>Client Configuration - Alternative client setups</li> </ul>"},{"location":"claude-plugin/#license-and-attribution","title":"License and Attribution","text":"<p>stata-toolbox plugin is part of the Stata-MCP project.</p> <ul> <li>License: AGPL-3.0</li> <li>Copyright: (c) 2026 Song Tan (Sepine Tam), Inc.</li> <li>Authors: Song Tan (sepinetam@gmail.com)</li> </ul> <p>Stata LSP: Copyright by euglevi with MIT License</p> <p>The plugin integrates independently developed components: - Stata-MCP Server: GitHub Repository - Stata LSP: GitHub Repository</p> <p>Document Version: 1.0.0 Last Updated: 2025-02-12 Maintainer: Song Tan (sepinetam@gmail.com)</p>"},{"location":"cli/","title":"CLI Reference","text":"<p>Stata-MCP provides a command-line interface (CLI) for various operations including starting MCP servers, running agent mode, and installing to different AI clients.</p>"},{"location":"cli/#installation","title":"Installation","text":"<p>Verify your installation:</p> <pre><code>stata-mcp --version\n</code></pre> <p>Check system compatibility:</p> <pre><code>stata-mcp --usable\n</code></pre>"},{"location":"cli/#commands","title":"Commands","text":""},{"location":"cli/#start-mcp-server","title":"Start MCP Server","text":"<p>Start the MCP server with different transport methods:</p> <pre><code># Start with stdio transport (default)\nstata-mcp\n\n# Explicitly specify transport method\nstata-mcp -t stdio\nstata-mcp -t sse\nstata-mcp -t http\n</code></pre> <p>Transport Options: - <code>stdio</code> - Standard input/output (default) - <code>sse</code> - Server-Sent Events - <code>http</code> - HTTP transport (automatically converted to streamable-http)</p>"},{"location":"cli/#agent-mode","title":"Agent Mode","text":"<p>Run Stata-MCP in interactive agent mode:</p> <pre><code># Start agent in current directory\nstata-mcp agent run\n\n# Start agent in specific directory\nstata-mcp agent run --work-dir /path/to/project\n</code></pre>"},{"location":"cli/#install-to-ai-clients","title":"Install to AI Clients","text":"<p>Install Stata-MCP to various AI coding assistants:</p> <pre><code># Install to Claude Desktop (default)\nstata-mcp install\n\n# Install to specific client\nstata-mcp install -c claude    # Claude Desktop\nstata-mcp install -c cc        # Claude Code\nstata-mcp install -c cursor    # Cursor\nstata-mcp install -c cline     # Cline\nstata-mcp install -c codex     # Codex\n</code></pre> <p>Supported Clients: - <code>claude</code> - Claude Desktop - <code>cc</code> - Claude Code - <code>cursor</code> - Cursor Editor - <code>cline</code> - Cline (VSCode extension) - <code>codex</code> - Codex</p>"},{"location":"cli/#options","title":"Options","text":""},{"location":"cli/#global-options","title":"Global Options","text":"Option Short Description <code>--version</code> <code>-v</code> Show version information <code>--help</code> <code>-h</code> Show help message <code>--usable</code> <code>-u</code> Check system compatibility <code>--transport</code> <code>-t</code> MCP transport method (stdio/sse/http)"},{"location":"cli/#agent-options","title":"Agent Options","text":"Option Description <code>--work-dir</code> Working directory for agent (default: current directory)"},{"location":"cli/#install-options","title":"Install Options","text":"Option Short Description <code>--client</code> <code>-c</code> Target client (default: claude)"},{"location":"cli/#examples","title":"Examples","text":""},{"location":"cli/#basic-usage","title":"Basic Usage","text":"<pre><code># Check if Stata-MCP can run on your system\nstata-mcp --usable\n\n# Start MCP server for Claude Desktop\nstata-mcp\n\n# Start with SSE transport\nstata-mcp -t sse\n</code></pre>"},{"location":"cli/#development-workflow","title":"Development Workflow","text":"<pre><code># 1. Check system compatibility\nstata-mcp --usable\n\n# 2. Install to Claude Desktop\nstata-mcp install\n\n# 3. Run agent for interactive analysis\nstata-mcp agent run\n</code></pre>"},{"location":"cli/#using-with-uvx","title":"Using with uvx","text":"<p>If you prefer not to install Stata-MCP globally, you can use <code>uvx</code>:</p> <pre><code># Check version\nuvx stata-mcp --version\n\n# Check compatibility\nuvx stata-mcp --usable\n\n# Run agent\nuvx stata-mcp agent run\n\n# Install to client\nuvx stata-mcp install -c cursor\n</code></pre>"},{"location":"cli/#exit-codes","title":"Exit Codes","text":"<ul> <li><code>0</code> - Success</li> <li><code>1</code> - Error (invalid client, system incompatibility, etc.)</li> <li><code>2</code> - Command line argument error</li> </ul>"},{"location":"cli/#environment-variables","title":"Environment Variables","text":"<p>Stata-MCP behavior can be configured through environment variables. See Configuration for details.</p> <p>Key environment variables:</p> <ul> <li><code>STATA_MCP_CWD</code> - Working directory for Stata operations</li> <li><code>STATA_MCP_LOGGING_ON</code> - Enable/disable logging</li> <li><code>STATA_MCP__IS_GUARD</code> - Enable security guard validation</li> <li><code>STATA_MCP__IS_MONITOR</code> - Enable RAM monitoring</li> </ul> <p>See the Configuration document for the complete list.</p>"},{"location":"cli/#troubleshooting","title":"Troubleshooting","text":""},{"location":"cli/#stata-not-found-error","title":"\"Stata not found\" Error","text":"<p>Ensure Stata is installed and accessible:</p> <pre><code>stata-mcp --usable\n</code></pre> <p>This will check if Stata can be found on your system.</p>"},{"location":"cli/#permission-errors","title":"Permission Errors","text":"<p>Some operations may require appropriate permissions: - Installing to Claude Desktop may need admin/user privileges - Working directories must be writable</p>"},{"location":"cli/#transport-issues","title":"Transport Issues","text":"<p>If you encounter issues with specific transport methods: - Default to <code>stdio</code> for most use cases - Use <code>--transport stdio</code> explicitly if auto-detection fails</p>"},{"location":"cli/#see-also","title":"See Also","text":"<ul> <li>Usage Guide - Detailed usage examples</li> <li>Configuration - Environment variables and settings</li> <li>Security - Security guard and validation</li> <li>Monitoring - Resource monitoring configuration</li> </ul>"},{"location":"clients/","title":"Client Configuration","text":"<p>Different AI clients have varying configuration formats for MCP servers. This page documents the configuration specifics for each supported client.</p>"},{"location":"clients/#standard-configuration-pattern","title":"Standard Configuration Pattern","text":"<p>Most AI clients follow this basic pattern:</p> <pre><code>{\n  \"mcpServers\": {\n    \"stata-mcp\": {\n      \"command\": \"uvx\",\n      \"args\": [\"stata-mcp\"]\n    }\n  }\n}\n</code></pre> <p>However, each client may have slight variations in file location, format, or supported features.</p>"},{"location":"clients/#client-specific-configurations","title":"Client-Specific Configurations","text":""},{"location":"clients/#claude-code","title":"Claude Code","text":"<p>Configuration Method: CLI command or <code>.mcp.json</code></p> <p>Global Installation:</p> <pre><code>claude mcp add stata-mcp -- uvx stata-mcp\n</code></pre> <p>Project-based Installation (Recommended):</p> <pre><code>cd ~/Documents/MyResearch\nclaude mcp add stata-mcp \\\n  --env STATA_MCP_CWD=$(pwd) \\\n  --scope project \\\n  -- uvx --directory $(pwd) stata-mcp\n</code></pre> <p>Configuration File: <code>.mcp.json</code> (created in project directory)</p> <p>Format: JSON</p> <pre><code>{\n  \"mcpServers\": {\n    \"stata-mcp\": {\n      \"command\": \"uvx\",\n      \"args\": [\"stata-mcp\"],\n      \"env\": {\n        \"STATA_MCP_CWD\": \"/absolute/path/to/project\"\n      }\n    }\n  }\n}\n</code></pre> <p>Unique Features: - \u2705 Project-scoped configuration (<code>--scope project</code>) - \u2705 Environment variable injection (<code>--env</code>) - \u2705 Directory specification (<code>--directory</code>) - \u2705 Version pinning support (<code>stata-mcp==1.13.0</code>)</p>"},{"location":"clients/#claude-desktop","title":"Claude Desktop","text":"<p>Configuration File: <code>~/Library/Application Support/Claude/claude_desktop_config.json</code> (macOS)</p> <p>Format: JSON</p> <pre><code>{\n  \"mcpServers\": {\n    \"stata-mcp\": {\n      \"command\": \"uvx\",\n      \"args\": [\"stata-mcp\"],\n      \"env\": {\n        \"STATA_MCP_CWD\": \"/path/to/project\",\n        \"STATA_CLI\": \"/Applications/Stata/StataMP\"\n      }\n    }\n  }\n}\n</code></pre> <p>Unique Features: - \u2705 Environment variable support via <code>env</code> object - \u2705 Manual configuration file editing required</p>"},{"location":"clients/#codex-vs-code-extension","title":"Codex (VS Code Extension)","text":"<p>Configuration File: <code>~/.codex/config.toml</code></p> <p>Format: TOML</p> <pre><code>[mcp_servers.stata-mcp]\ncommand = \"uvx\"\nargs = [\"stata-mcp\"]\n</code></pre> <p>With environment variables:</p> <pre><code>[mcp_servers.stata-mcp]\ncommand = \"uvx\"\nargs = [\"stata-mcp\"]\nenv = { STATA_MCP_CWD = \"/path/to/project\" }\n</code></pre> <p>Unique Features: - \u26a0\ufe0f Uses TOML format instead of JSON - \u2705 Environment variables via <code>env</code> table</p>"},{"location":"clients/#cline","title":"Cline","text":"<p>Configuration File: <code>~/Library/Application Support/Code/User/globalStorage/saoudrizwan.claude-dev/setting/cline_mcp_settings.json</code></p> <p>Format: JSON</p> <pre><code>{\n  \"mcpServers\": {\n    \"stata-mcp\": {\n      \"command\": \"uvx\",\n      \"args\": [\n        \"stata-mcp\"\n      ]\n    }\n  }\n}\n</code></pre> <p>Unique Features: - \u26a0\ufe0f Standard JSON format - \u26a0\ufe0f No special features or extensions</p>"},{"location":"clients/#cursor","title":"Cursor","text":"<p>Configuration File: Cursor settings (location varies by OS)</p> <p>Format: JSON</p> <pre><code>{\n  \"mcpServers\": {\n    \"stata-mcp\": {\n      \"command\": \"uvx\",\n      \"args\": [\n        \"--directory\",\n        \"/absolute/path/to/project\",\n        \"stata-mcp\"\n      ],\n      \"env\": {\n        \"STATA_MCP_CWD\": \"/absolute/path/to/project\"\n      }\n    }\n  }\n}\n</code></pre> <p>Known Issues: - \u26a0\ufe0f File system access limitations (may not access <code>Documents</code> directory) - \u26a0\ufe0f Requires both <code>--directory</code> in args and <code>STATA_MCP_CWD</code> environment variable (both must point to same path) - \u26a0\ufe0f Must use absolute paths (relative paths not supported) - \u2705 Environment variables supported</p>"},{"location":"clients/#cherry-studio","title":"Cherry Studio","text":"<p>Configuration File: Cherry Studio settings</p> <p>Format: JSON (same as Claude Desktop)</p> <pre><code>{\n  \"mcpServers\": {\n    \"stata-mcp\": {\n      \"command\": \"uvx\",\n      \"args\": [\"stata-mcp\"]\n    }\n  }\n}\n</code></pre> <p>Unique Features: - \u2705 Standard MCP configuration - \u2705 Compatible with Claude Desktop format</p>"},{"location":"clients/#configuration-options","title":"Configuration Options","text":""},{"location":"clients/#command-variations","title":"Command Variations","text":"<p>Standard (uses latest version):</p> <pre><code>\"command\": \"uvx\",\n\"args\": [\"stata-mcp\"]\n</code></pre> <p>Pinned Version:</p> <pre><code>\"command\": \"uvx\",\n\"args\": [\"stata-mcp==1.13.0\"]\n</code></pre> <p>With Custom Directory:</p> <pre><code>\"command\": \"uvx\",\n\"args\": [\n  \"--directory\",\n  \"/path/to/project\",\n  \"stata-mcp\"\n]\n</code></pre>"},{"location":"clients/#environment-variables","title":"Environment Variables","text":""},{"location":"clients/#core-variables","title":"Core Variables","text":"Variable Purpose Example <code>STATA_MCP_CWD</code> Working directory for Stata operations <code>\"/Users/user/research\"</code> <code>STATA_CLI</code> Path to specific Stata executable <code>\"/Applications/Stata/StataMP\"</code> <code>STATA_MCP_MODEL</code> LLM model for agent mode <code>\"gpt-4\"</code> <code>STATA_MCP_API_KEY</code> API key for LLM provider <code>\"sk-...\"</code> <code>STATA_MCP_API_BASE_URL</code> Custom API endpoint <code>\"https://api.openai.com/v1\"</code>"},{"location":"clients/#security-variables","title":"Security Variables","text":"Variable Purpose Default Example <code>STATA_MCP__IS_GUARD</code> Enable security guard validation <code>true</code> <code>\"true\"</code> or <code>\"false\"</code>"},{"location":"clients/#monitoring-variables","title":"Monitoring Variables","text":"Variable Purpose Default Example <code>STATA_MCP__IS_MONITOR</code> Enable RAM monitoring <code>false</code> <code>\"true\"</code> or <code>\"false\"</code> <code>STATA_MCP__RAM_LIMIT</code> Maximum RAM in MB <code>-1</code> (no limit) <code>\"8192\"</code> for 8GB"},{"location":"clients/#debug-variables","title":"Debug Variables","text":"Variable Purpose Default Example <code>STATA_MCP__IS_DEBUG</code> Enable debug mode <code>false</code> <code>\"true\"</code> or <code>\"false\"</code> <code>STATA_MCP__LOGGING_ON</code> Enable logging <code>true</code> <code>\"true\"</code> or <code>\"false\"</code> <code>STATA_MCP__LOGGING_CONSOLE_HANDLER_ON</code> Enable console logging <code>false</code> <code>\"true\"</code> or <code>\"false\"</code> <code>STATA_MCP__LOGGING_FILE_HANDLER_ON</code> Enable file logging <code>true</code> <code>\"true\"</code> or <code>\"false\"</code> <code>STATA_MCP__LOG_FILE</code> Custom log file path <code>~/.statamcp/stata_mcp_debug.log</code> <code>\"/var/log/stata-mcp/debug.log\"</code> <p>JSON Format:</p> <pre><code>\"env\": {\n  \"STATA_MCP_CWD\": \"/path/to/project\",\n  \"STATA_CLI\": \"/path/to/stata\"\n}\n</code></pre> <p>With Security and Monitoring:</p> <pre><code>\"env\": {\n  \"STATA_MCP_CWD\": \"/path/to/project\",\n  \"STATA_MCP__IS_GUARD\": \"true\",\n  \"STATA_MCP__IS_MONITOR\": \"true\",\n  \"STATA_MCP__RAM_LIMIT\": \"8192\"\n}\n</code></pre> <p>TOML Format (Codex):</p> <pre><code>env = { STATA_MCP_CWD = \"/path/to/project\" }\n</code></pre> <p>With All Features:</p> <pre><code>env.STATA_MCP_CWD = \"/path/to/project\"\nenv.STATA_MCP__IS_GUARD = \"true\"\nenv.STATA_MCP__IS_MONITOR = \"true\"\nenv.STATA_MCP__RAM_LIMIT = \"8192\"\nenv.STATA_MCP__LOGGING_CONSOLE_HANDLER_ON = \"true\"\n</code></pre>"},{"location":"clients/#configuration-file-locations","title":"Configuration File Locations","text":"Client Config File Location Format Claude Code <code>.mcp.json</code> (project) or global config JSON Claude Desktop <code>~/Library/Application Support/Claude/claude_desktop_config.json</code> JSON Codex <code>~/.codex/config.toml</code> TOML Cline <code>~/Library/Application Support/Code/User/globalStorage/saoudrizwan.claude-dev/setting/cline_mcp_settings.json</code> JSON Cursor Cursor settings directory JSON Cherry Studio Cherry Studio settings directory JSON"},{"location":"clients/#troubleshooting","title":"Troubleshooting","text":""},{"location":"clients/#configuration-not-detected","title":"Configuration Not Detected","text":"<ol> <li>Verify file path: Check if configuration file exists in the correct location</li> <li>Validate JSON/TOML syntax: Use online validators to check for syntax errors</li> <li>Restart client: Most clients require restart after configuration changes</li> <li>Check logs: Look for MCP server connection errors in client logs</li> </ol>"},{"location":"clients/#path-issues","title":"Path Issues","text":"<p>Problem: Stata-MCP cannot access project files</p> <p>Solution: - Use absolute paths for <code>STATA_MCP_CWD</code> - Ensure paths are within client's allowed directories - Check client's file system access permissions</p>"},{"location":"clients/#version-conflicts","title":"Version Conflicts","text":"<p>Problem: Wrong Stata-MCP version loaded</p> <p>Solution: - Clear Python package cache: <code>pip cache purge stata-mcp</code> - Pin specific version: <code>uvx stata-mcp==1.13.0</code> - Use <code>uvx --refresh stata-mcp</code> to force refresh</p>"},{"location":"clients/#best-practices","title":"Best Practices","text":"<ol> <li>Use project-scoped configuration when available (Claude Code)</li> <li>Pin versions in production environments</li> <li>Set absolute paths for working directories</li> <li>Test configuration with <code>uvx stata-mcp --usable</code> before adding to client</li> <li>Document custom configurations for team collaboration</li> </ol>"},{"location":"clients/#additional-resources","title":"Additional Resources","text":"<ul> <li>Usage Guide - Comprehensive usage examples</li> <li>Overview - Architecture and design</li> <li>MCP Tools - Available tools reference</li> </ul>"},{"location":"configuration/","title":"Configuration System","text":"<p>Stata-MCP uses a hierarchical configuration system with three levels of priority:</p> <ol> <li>Environment Variables (highest priority)</li> <li>Configuration File (<code>~/.statamcp/config.toml</code>)</li> <li>Default Values (lowest priority)</li> </ol>"},{"location":"configuration/#configuration-file","title":"Configuration File","text":""},{"location":"configuration/#location","title":"Location","text":"<p>The configuration file is located at:</p> <pre><code>~/.statamcp/config.toml\n</code></pre> <p>On different platforms: - macOS/Linux: <code>/home/username/.statamcp/config.toml</code> - Windows: <code>C:\\Users\\Username\\.statamcp\\config.toml</code></p>"},{"location":"configuration/#example-configuration","title":"Example Configuration","text":"<pre><code>[DEBUG]\nIS_DEBUG = false\n\n[DEBUG.logging]\nLOGGING_ON = true\nLOGGING_CONSOLE_HANDLER_ON = false\nLOGGING_FILE_HANDLER_ON = true\nLOG_FILE = \"~/\"\n\nMAX_BYTES = 10_000_000\nBACKUP_COUNT = 5\n\n[SECURITY]\nIS_GUARD = true\n\n[PROJECT]\nWORKING_DIR = \"\"\n\n[MONITOR]\nIS_MONITOR = false\nMAX_RAM_MB = -1\n\n[STATA]\n# Optional: Override automatic Stata detection\n# STATA_CLI = \"/path/to/stata-mp\"\n</code></pre>"},{"location":"configuration/#configuration-sections","title":"Configuration Sections","text":""},{"location":"configuration/#debug-section","title":"DEBUG Section","text":"<p>Controls debugging and logging behavior.</p>"},{"location":"configuration/#debugis_debug","title":"<code>DEBUG.IS_DEBUG</code>","text":"<p>Enable debug mode for verbose output.</p> <ul> <li>Type: Boolean</li> <li>Default: <code>false</code></li> <li>Environment Variable: <code>STATA_MCP__IS_DEBUG</code></li> <li>Example:   <code>bash   export STATA_MCP__IS_DEBUG=true</code></li> </ul>"},{"location":"configuration/#debuglogginglogging_on","title":"<code>DEBUG.logging.LOGGING_ON</code>","text":"<p>Enable or disable all logging.</p> <ul> <li>Type: Boolean</li> <li>Default: <code>true</code></li> <li>Environment Variable: <code>STATA_MCP__LOGGING_ON</code></li> <li>Example:   <code>bash   export STATA_MCP__LOGGING_ON=false</code></li> </ul>"},{"location":"configuration/#debuglogginglogging_console_handler_on","title":"<code>DEBUG.logging.LOGGING_CONSOLE_HANDLER_ON</code>","text":"<p>Enable console output for logs.</p> <ul> <li>Type: Boolean</li> <li>Default: <code>false</code></li> <li>Environment Variable: <code>STATA_MCP__LOGGING_CONSOLE_HANDLER_ON</code></li> <li>Example:   <code>bash   export STATA_MCP__LOGGING_CONSOLE_HANDLER_ON=true</code></li> </ul>"},{"location":"configuration/#debuglogginglogging_file_handler_on","title":"<code>DEBUG.logging.LOGGING_FILE_HANDLER_ON</code>","text":"<p>Enable file logging.</p> <ul> <li>Type: Boolean</li> <li>Default: <code>true</code></li> <li>Environment Variable: <code>STATA_MCP__LOGGING_FILE_HANDLER_ON</code></li> <li>Example:   <code>bash   export STATA_MCP__LOGGING_FILE_HANDLER_ON=true</code></li> </ul>"},{"location":"configuration/#debuglogginglog_file","title":"<code>DEBUG.logging.LOG_FILE</code>","text":"<p>Specify the log file location.</p> <ul> <li>Type: Path (string)</li> <li>Default: <code>~/.statamcp/stata_mcp_debug.log</code></li> <li>Environment Variable: <code>STATA_MCP__LOG_FILE</code></li> <li>Example:   <code>bash   export STATA_MCP__LOG_FILE=\"/var/log/stata-mcp/debug.log\"</code></li> </ul>"},{"location":"configuration/#debugloggingmax_bytes","title":"<code>DEBUG.logging.MAX_BYTES</code>","text":"<p>Maximum size of a single log file before rotation.</p> <ul> <li>Type: Integer (bytes)</li> <li>Default: <code>10_000_000</code> (10 MB)</li> <li>Environment Variable: <code>STATA_MCP__LOGGING__MAX_BYTES</code></li> <li>Example:   <code>bash   export STATA_MCP__LOGGING__MAX_BYTES=50_000_000</code></li> </ul>"},{"location":"configuration/#debugloggingbackup_count","title":"<code>DEBUG.logging.BACKUP_COUNT</code>","text":"<p>Number of backup log files to keep.</p> <ul> <li>Type: Integer</li> <li>Default: <code>5</code></li> <li>Environment Variable: <code>STATA_MCP__LOGGING__BACKUP_COUNT</code></li> <li>Example:   <code>bash   export STATA_MCP__LOGGING__BACKUP_COUNT=10</code></li> </ul>"},{"location":"configuration/#security-section","title":"SECURITY Section","text":"<p>Controls security features.</p>"},{"location":"configuration/#securityis_guard","title":"<code>SECURITY.IS_GUARD</code>","text":"<p>Enable security guard validation for Stata dofiles.</p> <ul> <li>Type: Boolean</li> <li>Default: <code>true</code></li> <li>Environment Variable: <code>STATA_MCP__IS_GUARD</code></li> <li>Description: When enabled, validates all dofile code against dangerous commands and patterns before execution</li> <li>Example:   <code>bash   export STATA_MCP__IS_GUARD=true</code></li> </ul> <p>For more details, see Security Guard Documentation.</p>"},{"location":"configuration/#project-section","title":"PROJECT Section","text":"<p>Controls project-specific settings.</p>"},{"location":"configuration/#projectworking_dir","title":"<code>PROJECT.WORKING_DIR</code>","text":"<p>Set the working directory for Stata-MCP operations.</p> <ul> <li>Type: Path (string)</li> <li>Default: Current directory (if writable) or <code>~/Documents</code></li> <li>Environment Variable: <code>STATA_MCP__CWD</code> (double underscore)</li> <li>Description:</li> <li>If set and writable, all output files will be organized under <code>&lt;WORKING_DIR&gt;/stata-mcp-folder/</code></li> <li>If not set or not writable, falls back to current directory or <code>~/Documents</code></li> <li>Legacy support: <code>STATA_MCP_CWD</code> (single underscore) is still supported but deprecated</li> <li>Example:   <code>bash   export STATA_MCP__CWD=\"/projects/my-research\"</code></li> </ul> <p>The working directory structure:</p> <pre><code>&lt;WORKING_DIR&gt;/stata-mcp-folder/\n\u251c\u2500\u2500 stata-mcp-log/      # Stata execution logs\n\u251c\u2500\u2500 stata-mcp-dofile/   # Generated do-files\n\u251c\u2500\u2500 stata-mcp-result/   # Analysis results\n\u2514\u2500\u2500 stata-mcp-tmp/      # Temporary files\n</code></pre>"},{"location":"configuration/#monitor-section","title":"MONITOR Section","text":"<p>Controls performance monitoring features.</p>"},{"location":"configuration/#monitoris_monitor","title":"<code>MONITOR.IS_MONITOR</code>","text":"<p>Enable RAM monitoring for Stata processes.</p> <ul> <li>Type: Boolean</li> <li>Default: <code>false</code></li> <li>Environment Variable: <code>STATA_MCP__IS_MONITOR</code></li> <li>Description: When enabled, monitors Stata subprocess RAM usage during execution</li> <li>Example:   <code>bash   export STATA_MCP__IS_MONITOR=true</code></li> </ul> <p>For more details, see Monitoring Documentation.</p>"},{"location":"configuration/#monitormax_ram_mb","title":"<code>MONITOR.MAX_RAM_MB</code>","text":"<p>Maximum RAM limit in megabytes.</p> <ul> <li>Type: Integer</li> <li>Default: <code>-1</code> (no limit)</li> <li>Environment Variable: <code>STATA_MCP__RAM_LIMIT</code></li> <li>Description:</li> <li><code>-1</code> means no limit (default)</li> <li>When set to a positive value, Stata processes exceeding this limit will be terminated</li> <li>Example:   <code>bash   export STATA_MCP__RAM_LIMIT=8192  # 8 GB limit</code></li> </ul>"},{"location":"configuration/#stata-section","title":"STATA Section","text":"<p>Controls Stata executable detection.</p>"},{"location":"configuration/#statastata_cli","title":"<code>STATA.STATA_CLI</code>","text":"<p>Override automatic Stata detection.</p> <ul> <li>Type: Path (string)</li> <li>Default: Auto-detected based on platform</li> <li>Description:</li> <li>macOS: <code>/Applications/Stata/StataMP.app/Contents/MacOS/stata-mp</code></li> <li>Windows: <code>C:\\Program Files\\Stata18\\StataMP-64.exe</code></li> <li>Linux: <code>stata-mp</code> (from PATH)</li> <li>Example:   <code>toml   [STATA]   STATA_CLI = \"/usr/local/stata17/stata-mp\"</code></li> </ul>"},{"location":"configuration/#using-environment-variables","title":"Using Environment Variables","text":""},{"location":"configuration/#quick-setup","title":"Quick Setup","text":"<pre><code># Enable debug mode\nexport STATA_MCP__IS_DEBUG=true\n\n# Set working directory\nexport STATA_MCP__CWD=\"/projects/my-analysis\"\n\n# Enable monitoring with 8GB RAM limit\nexport STATA_MCP__IS_MONITOR=true\nexport STATA_MCP__RAM_LIMIT=8192\n\n# Disable security guard (not recommended)\nexport STATA_MCP__IS_GUARD=false\n\n# Enable console logging\nexport STATA_MCP__LOGGING_CONSOLE_HANDLER_ON=true\n</code></pre>"},{"location":"configuration/#priority-example","title":"Priority Example","text":"<p>If you set the same option in multiple places:</p> <pre><code># Config file: IS_GUARD = true\n# Environment variable: STATA_MCP__IS_GUARD=false\nexport STATA_MCP__IS_GUARD=false\n\n# Result: Security guard is disabled (environment variable wins)\n</code></pre>"},{"location":"configuration/#configuration-validation","title":"Configuration Validation","text":"<p>The configuration system includes built-in validation:</p> <ul> <li>Boolean values: Must be <code>true</code> or <code>false</code> (case-insensitive)</li> <li>Integer values: Must be valid integers</li> <li>Path values: Automatically expanded for <code>~</code> (home directory)</li> <li>Invalid values: Fall back to defaults automatically</li> </ul>"},{"location":"configuration/#common-configuration-patterns","title":"Common Configuration Patterns","text":""},{"location":"configuration/#development-setup","title":"Development Setup","text":"<pre><code>[DEBUG]\nIS_DEBUG = true\n\n[DEBUG.logging]\nLOGGING_ON = true\nLOGGING_CONSOLE_HANDLER_ON = true\nLOGGING_FILE_HANDLER_ON = false\n</code></pre>"},{"location":"configuration/#production-setup","title":"Production Setup","text":"<pre><code>[DEBUG]\nIS_DEBUG = false\n\n[DEBUG.logging]\nLOGGING_ON = true\nLOGGING_CONSOLE_HANDLER_ON = false\nLOGGING_FILE_HANDLER_ON = true\nMAX_BYTES = 50_000_000\nBACKUP_COUNT = 10\n\n[SECURITY]\nIS_GUARD = true\n\n[MONITOR]\nIS_MONITOR = true\nMAX_RAM_MB = 16384\n</code></pre>"},{"location":"configuration/#high-performance-computing","title":"High-Performance Computing","text":"<pre><code>[DEBUG]\nIS_DEBUG = false\n\n[DEBUG.logging]\nLOGGING_ON = false\n\n[MONITOR]\nIS_MONITOR = true\nMAX_RAM_MB = 65536  # 64 GB\n</code></pre>"},{"location":"configuration/#troubleshooting","title":"Troubleshooting","text":""},{"location":"configuration/#configuration-not-loading","title":"Configuration Not Loading","text":"<ol> <li> <p>Check if config file exists:    <code>bash    ls ~/.statamcp/config.toml</code></p> </li> <li> <p>Verify TOML syntax:    <code>bash    python3 -c \"import tomllib; tomllib.load(open('~/.statamcp/config.toml', 'rb'))\"</code></p> </li> <li> <p>Check for environment variable conflicts:    <code>bash    env | grep STATA_MCP</code></p> </li> </ol>"},{"location":"configuration/#working-directory-issues","title":"Working Directory Issues","text":"<p>If the working directory is not writable, Stata-MCP will fall back to <code>~/Documents</code>. To fix:</p> <ol> <li> <p>Check directory permissions:    <code>bash    ls -la /your/working/directory</code></p> </li> <li> <p>Create directory with proper permissions:    <code>bash    mkdir -p /your/working/directory    chmod u+w /your/working/directory</code></p> </li> </ol>"},{"location":"configuration/#log-files-not-created","title":"Log Files Not Created","text":"<ol> <li> <p>Check if logging is enabled:    <code>bash    echo $STATA_MCP__LOGGING_ON</code></p> </li> <li> <p>Verify log file path is writable:    <code>bash    touch ~/.statamcp/stata_mcp_debug.log</code></p> </li> <li> <p>Check disk space:    <code>bash    df -h</code></p> </li> </ol>"},{"location":"monitoring/","title":"Monitoring System","text":"<p>The monitoring system provides real-time monitoring of Stata processes during execution. This feature is designed to prevent resource exhaustion and improve system stability.</p>"},{"location":"monitoring/#overview","title":"Overview","text":"<p>The monitoring system is disabled by default to maintain 100% backward compatibility. When enabled, it monitors Stata subprocess execution and can automatically terminate processes that exceed configured resource limits.</p>"},{"location":"monitoring/#current-features","title":"Current Features","text":"<ul> <li>RAM Monitoring: Track memory usage and terminate processes exceeding RAM limits</li> <li>Cross-Platform: Works on macOS, Linux, and Windows using <code>psutil</code></li> <li>Non-Invasive: Minimal overhead when disabled, daemon thread when enabled</li> <li>Extensible: Abstract base class for adding new monitor types (e.g., timeout monitoring)</li> </ul>"},{"location":"monitoring/#architecture","title":"Architecture","text":""},{"location":"monitoring/#monitorbase","title":"MonitorBase","text":"<p>Abstract base class for all monitor implementations:</p> <pre><code>class MonitorBase(ABC):\n    @abstractmethod\n    def start(self, process: Any) -&gt; None:\n        \"\"\"Start monitoring the given process.\"\"\"\n        pass\n\n    @abstractmethod\n    def stop(self) -&gt; None:\n        \"\"\"Stop monitoring.\"\"\"\n        pass\n</code></pre>"},{"location":"monitoring/#rammonitor","title":"RAMMonitor","text":"<p>Monitors RAM usage of Stata processes:</p> <ul> <li>Check Interval: 0.5 seconds</li> <li>Metric: RSS (Resident Set Size) in MB</li> <li>Action: Kills process when limit exceeded</li> <li>Error: Raises <code>RAMLimitExceededError</code> with details</li> </ul>"},{"location":"monitoring/#configuration","title":"Configuration","text":""},{"location":"monitoring/#enable-monitoring","title":"Enable Monitoring","text":"<p>Monitoring is controlled by two configuration options:</p>"},{"location":"monitoring/#option-1-configuration-file","title":"Option 1: Configuration File","text":"<p>Edit <code>~/.statamcp/config.toml</code>:</p> <pre><code>[MONITOR]\nIS_MONITOR = true\nMAX_RAM_MB = 8192  # 8 GB limit\n</code></pre>"},{"location":"monitoring/#option-2-environment-variables","title":"Option 2: Environment Variables","text":"<pre><code>export STATA_MCP__IS_MONITOR=true\nexport STATA_MCP__RAM_LIMIT=8192\n</code></pre>"},{"location":"monitoring/#configuration-priority","title":"Configuration Priority","text":"<ol> <li>Environment variables (highest)</li> <li>Config file (<code>~/.statamcp/config.toml</code>)</li> <li>Default values (lowest)</li> </ol>"},{"location":"monitoring/#ram-limit-values","title":"RAM Limit Values","text":"<ul> <li><code>-1</code> or <code>None</code>: No limit (default)</li> <li><code>0</code>: Not recommended (will kill immediately)</li> <li>Positive value: RAM limit in MB</li> </ul> <p>Examples:</p> <pre><code># No limit (default)\nexport STATA_MCP__RAM_LIMIT=-1\n\n# 4 GB limit\nexport STATA_MCP__RAM_LIMIT=4096\n\n# 8 GB limit\nexport STATA_MCP__RAM_LIMIT=8192\n\n# 16 GB limit\nexport STATA_MCP__RAM_LIMIT=16384\n</code></pre>"},{"location":"monitoring/#usage","title":"Usage","text":""},{"location":"monitoring/#basic-setup","title":"Basic Setup","text":"<ol> <li> <p>Enable monitoring in config:    <code>bash    export STATA_MCP__IS_MONITOR=true    export STATA_MCP__RAM_LIMIT=8192</code></p> </li> <li> <p>Run Stata-MCP normally:    <code>bash    stata-mcp    # or    stata-mcp agent run</code></p> </li> <li> <p>Monitoring is automatic when enabled:</p> </li> <li>No code changes needed</li> <li>Works with all MCP tools</li> <li>Integrates seamlessly with existing workflows</li> </ol>"},{"location":"monitoring/#programmatic-usage","title":"Programmatic Usage","text":"<p>If you're using Stata-MCP as a library:</p> <pre><code>from stata_mcp.monitor import RAMMonitor\nfrom stata_mcp.core.stata import StataDo\n\n# Create monitor with 8GB limit\nmonitor = RAMMonitor(max_ram_mb=8192)\n\n# Pass to StataDo\nstata = StataDo(\n    dofile_path=\"analysis.do\",\n    monitors=[monitor]  # Optional: list of monitors\n)\n\n# Execution is automatically monitored\nresult = stata.execute()\n</code></pre>"},{"location":"monitoring/#behavior","title":"Behavior","text":""},{"location":"monitoring/#when-ram-limit-is-exceeded","title":"When RAM Limit is Exceeded","text":"<ol> <li>Detection: Monitor detects RAM usage &gt; limit</li> <li>Logging: Warning logged with details</li> <li>Termination: Process is killed immediately</li> <li>Error: <code>RAMLimitExceededError</code> is raised</li> </ol>"},{"location":"monitoring/#example-output","title":"Example Output","text":"<pre><code>WARNING: RAM limit exceeded: 8256MB &gt; 8192MB. Killing Stata process (PID: 12345)\nERROR: RAM limit exceeded: Used 8256MB, Limit 8192MB\n</code></pre>"},{"location":"monitoring/#normal-completion","title":"Normal Completion","text":"<p>If process finishes before exceeding limit: - Monitor stops gracefully - No errors raised - Normal execution flow continues</p>"},{"location":"monitoring/#performance-considerations","title":"Performance Considerations","text":""},{"location":"monitoring/#overhead","title":"Overhead","text":"<ul> <li>Disabled: Zero overhead (default)</li> <li>Enabled: Minimal overhead from daemon thread</li> <li>One RAM check every 0.5 seconds</li> <li>Uses <code>psutil</code> for cross-platform compatibility</li> </ul>"},{"location":"monitoring/#recommendations","title":"Recommendations","text":"<p>For production environments:</p> <pre><code>[MONITOR]\nIS_MONITOR = true\nMAX_RAM_MB = 16384  # Set reasonable limit for your hardware\n</code></pre> <p>For development environments:</p> <pre><code>[MONITOR]\nIS_MONITOR = false  # Disable to avoid accidental termination\n</code></pre> <p>For high-performance computing:</p> <pre><code>[MONITOR]\nIS_MONITOR = true\nMAX_RAM_MB = 65536  # 64 GB for large datasets\n</code></pre>"},{"location":"monitoring/#error-handling","title":"Error Handling","text":""},{"location":"monitoring/#ramlimitexceedederror","title":"RAMLimitExceededError","text":"<p>Raised when RAM limit is exceeded:</p> <pre><code>from stata_mcp.core.types import RAMLimitExceededError\n\ntry:\n    result = stata.execute()\nexcept RAMLimitExceededError as e:\n    print(f\"RAM exceeded: {e.ram_used_mb:.0f}MB &gt; {e.ram_limit_mb}MB\")\n    # Handle error: save work, notify user, etc.\n</code></pre> <p>Error attributes: - <code>ram_used_mb</code>: Actual RAM used when limit exceeded - <code>ram_limit_mb</code>: Configured RAM limit</p>"},{"location":"monitoring/#extensibility","title":"Extensibility","text":""},{"location":"monitoring/#creating-custom-monitors","title":"Creating Custom Monitors","text":"<p>You can create custom monitors by extending <code>MonitorBase</code>:</p> <pre><code>from stata_mcp.monitor.base import MonitorBase\nimport time\nimport threading\n\nclass TimeoutMonitor(MonitorBase):\n    \"\"\"Monitor and timeout long-running processes.\"\"\"\n\n    def __init__(self, timeout_seconds: int):\n        self.timeout = timeout_seconds\n        self._start_time = None\n        self._monitor_thread = None\n        self._stop_event = threading.Event()\n\n    def start(self, process):\n        \"\"\"Start timeout monitoring.\"\"\"\n        self._start_time = time.time()\n        self.process = process\n\n        def monitor_loop():\n            while not self._stop_event.is_set():\n                if time.time() - self._start_time &gt; self.timeout:\n                    self.process.kill()\n                    break\n                self._stop_event.wait(1)\n\n        self._monitor_thread = threading.Thread(\n            target=monitor_loop,\n            daemon=True\n        )\n        self._monitor_thread.start()\n\n    def stop(self):\n        \"\"\"Stop monitoring.\"\"\"\n        self._stop_event.set()\n        if self._monitor_thread:\n            self._monitor_thread.join(timeout=1.0)\n</code></pre>"},{"location":"monitoring/#using-multiple-monitors","title":"Using Multiple Monitors","text":"<p>You can use multiple monitors simultaneously:</p> <pre><code>from stata_mcp.monitor import RAMMonitor, TimeoutMonitor\n\n# Create multiple monitors\nram_monitor = RAMMonitor(max_ram_mb=8192)\ntimeout_monitor = TimeoutMonitor(timeout_seconds=3600)\n\n# Pass to StataDo\nstata = StataDo(\n    dofile_path=\"analysis.do\",\n    monitors=[ram_monitor, timeout_monitor]\n)\n</code></pre>"},{"location":"monitoring/#troubleshooting","title":"Troubleshooting","text":""},{"location":"monitoring/#monitor-not-working","title":"Monitor Not Working","text":"<ol> <li> <p>Check if monitoring is enabled:    <code>bash    echo $STATA_MCP__IS_MONITOR</code></p> </li> <li> <p>Verify config file syntax:    <code>bash    cat ~/.statamcp/config.toml</code></p> </li> <li> <p>Check for environment variable conflicts:    <code>bash    env | grep STATA_MCP</code></p> </li> </ol>"},{"location":"monitoring/#process-killed-unexpectedly","title":"Process Killed Unexpectedly","text":"<ol> <li> <p>Check RAM limit is reasonable:    <code>bash    echo $STATA_MCP__RAM_LIMIT</code></p> </li> <li> <p>Review logs for termination reason:    <code>bash    tail -f ~/.statamcp/stata_mcp_debug.log</code></p> </li> <li> <p>Increase limit if needed:    <code>bash    export STATA_MCP__RAM_LIMIT=16384</code></p> </li> </ol>"},{"location":"monitoring/#psutil-issues","title":"psutil Issues","text":"<p>If you encounter <code>psutil</code> errors:</p> <ol> <li> <p>Ensure psutil is installed:    <code>bash    uv pip install psutil&gt;=6.0.0</code></p> </li> <li> <p>Check psutil version:    <code>bash    python3 -c \"import psutil; print(psutil.__version__)\"</code></p> </li> <li> <p>Verify process access permissions (Linux/macOS):    <code>bash    # Monitor should have access to child processes    # No special action needed for child processes</code></p> </li> </ol>"},{"location":"monitoring/#best-practices","title":"Best Practices","text":""},{"location":"monitoring/#1-start-with-no-limit","title":"1. Start with No Limit","text":"<p>For initial testing:</p> <pre><code>export STATA_MCP__IS_MONITOR=true\nexport STATA_MCP__RAM_LIMIT=-1  # No limit initially\n</code></pre>"},{"location":"monitoring/#2-monitor-typical-usage","title":"2. Monitor Typical Usage","text":"<p>Run typical workloads and observe RAM usage in logs.</p>"},{"location":"monitoring/#3-set-reasonable-limit","title":"3. Set Reasonable Limit","text":"<p>Set limit 20-50% above typical usage:</p> <pre><code># If typical usage is 6GB\nexport STATA_MCP__RAM_LIMIT=8192  # 8GB limit\n</code></pre>"},{"location":"monitoring/#4-test-edge-cases","title":"4. Test Edge Cases","text":"<p>Test with large datasets to ensure limit is appropriate.</p>"},{"location":"monitoring/#5-document-limits","title":"5. Document Limits","text":"<p>Document RAM limits in project documentation for team members.</p>"},{"location":"monitoring/#security-considerations","title":"Security Considerations","text":"<ul> <li>Monitor runs in daemon thread (terminated when main thread exits)</li> <li>No privilege escalation required</li> <li>Uses standard <code>psutil</code> library for cross-platform compatibility</li> <li>Monitor only has access to child processes it creates</li> </ul>"},{"location":"monitoring/#future-enhancements","title":"Future Enhancements","text":"<p>Potential future monitor types: - Timeout Monitor: Limit execution time - CPU Monitor: Track CPU usage percentage - Disk I/O Monitor: Monitor disk read/write operations - Network Monitor: Track network activity (if applicable)</p>"},{"location":"monitoring/#notes","title":"Notes","text":"<ul> <li>This feature was developed with assistance from Claude Code and GLM-4.7</li> <li>Monitoring is opt-in via configuration</li> <li>When disabled, behavior is 100% identical to previous versions</li> <li>Monitor system designed for extensibility to support future use cases</li> </ul>"},{"location":"overview/","title":"Stata-MCP Overview","text":""},{"location":"overview/#what-is-stata-mcp-and-stata","title":"What is Stata-MCP and Stata?","text":"<p>Stata-MCP is a Model Context Protocol (MCP) server that bridges Large Language Models (LLMs) with Stata, enabling autonomous econometric analysis and statistical computation. Built on the FastMCP framework, Stata-MCP exposes Stata's comprehensive analytical capabilities as structured tools that LLMs can invoke programmatically, transforming natural language queries into reproducible Stata workflows.</p>"},{"location":"overview/#why-stata-mcp","title":"Why Stata-MCP?","text":"<p>Stata remains the dominant analytical engine in empirical social science research. In China's economics discipline alone, over 80% of published articles are empirical studies, with more than 98.4% utilizing Stata for analysis. This prevalence stems from Stata's mature ecosystem, methodological completeness, and reliability in reproducing published research.</p> <p>Stata-MCP addresses a critical gap in AI-assisted research: while modern LLMs excel at code generation and statistical reasoning, they lack native execution environments for domain-specific tools like Stata. By implementing the MCP protocol, Stata-MCP enables:</p> <ul> <li>Deterministic Execution: LLM-generated Stata code executes in a controlled, reproducible environment</li> <li>Methodological Rigor: Access to Stata's validated econometric implementations ensures analytical integrity</li> <li>Workflow Orchestration: Complex multi-step analyses (data cleaning \u2192 estimation \u2192 visualization) become automated pipelines</li> <li>Cross-Platform Compatibility: Unified abstraction layer across macOS, Windows, and Linux environments</li> </ul>"},{"location":"overview/#architecture-overview","title":"Architecture Overview","text":"<p>Stata-MCP operates through four architectural layers:</p>"},{"location":"overview/#1-protocol-layer-mcp-server","title":"1. Protocol Layer (MCP Server)","text":"<p>The <code>FastMCP</code>-based server (<code>src/stata_mcp/__init__.py</code>) implements the Model Context Protocol, exposing Stata operations as structured tools. Each tool defines: - Input parameter schemas with type validation - Output serialization for LLM consumption - Error handling and logging infrastructure - Resource registration for stateful operations</p>"},{"location":"overview/#2-execution-layer-stata-integration","title":"2. Execution Layer (Stata Integration)","text":"<p>Platform-specific Stata controllers manage command execution: - <code>StataFinder</code>: Locates Stata executables across operating systems (macOS: <code>/Applications/Stata/</code>, Windows: <code>Program Files</code>, Linux: system PATH) - <code>StataController</code>: Manages Stata process lifecycle, command invocation, and exit code monitoring - <code>StataDo</code>: Handles do-file execution with log capture and error reporting</p>"},{"location":"overview/#3-security-monitoring-layer","title":"3. Security &amp; Monitoring Layer","text":"<p>Advanced safety features for production deployments: - Security Guard: Validates dofiles against dangerous commands (shell execution, file deletion, etc.) - Monitoring System: Real-time RAM monitoring with automatic process termination - Blacklist-based validation: Blocks dangerous operations before execution - Resource limits: Prevents memory exhaustion and system instability</p>"},{"location":"overview/#4-configuration-layer","title":"4. Configuration Layer","text":"<p>Unified configuration management with hierarchical priority: - Configuration System: TOML-based config file at <code>~/.statamcp/config.toml</code> - Environment variables: Override settings for specific sessions - Priority: Environment variables &gt; config file &gt; defaults - Sections: DEBUG, SECURITY, PROJECT, MONITOR</p>"},{"location":"overview/#5-application-layer-modes-tools","title":"5. Application Layer (Modes &amp; Tools)","text":"<p>Two primary operational modes:</p>"},{"location":"overview/#mcp-server-mode-default","title":"MCP Server Mode (Default)","text":"<p>Operates as a stdio/HTTP/SSE server, responding to tool invocation requests from MCP-compliant clients. Tools include:</p> Tool Purpose <code>stata_do</code> Execute do-files with log retrieval <code>write_dofile</code> Create timestamped do-files <code>append_dofile</code> Extend existing do-files immutably <code>get_data_info</code> Analyze CSV/DTA files with statistical summaries <code>help</code> Retrieve Stata command documentation (cached) <code>ssc_install</code> Install packages from SSC/GitHub/net sources <code>load_figure</code> Load Stata-generated graphics for display <code>read_file</code> Generic file reading with encoding support <code>mk_dir</code> Secure directory creation with validation"},{"location":"overview/#agent-mode-agent-run-command","title":"Agent Mode (<code>agent run</code> command)","text":"<p>Interactive REPL agent for conversational analysis: - Read-Eval-Print Loop (REPL) interface for multi-turn sessions - SQLite-based session management for conversation history - Custom working directory support via <code>agent run &lt;path&gt;</code> - Environment variables for model configuration (<code>STATA_MCP_MODEL</code>, <code>STATA_MCP_API_KEY</code>) - Supports any OpenAI-compatible API endpoint</p>"},{"location":"overview/#data-processing-pipeline","title":"Data Processing Pipeline","text":"<p>Stata-MCP implements a polymorphic data analysis system supporting multiple formats:</p>"},{"location":"overview/#datainfo-architecture","title":"DataInfo Architecture","text":"<p>Abstract base class <code>DataInfoBase</code> with format-specific implementations: - <code>DtaDataInfo</code>: Native Stata <code>.dta</code> format with metadata extraction - <code>CsvDataInfo</code>: CSV files with encoding detection and type inference - <code>ExcelDataInfo</code>: Excel workbooks with sheet selection</p>"},{"location":"overview/#statistical-metrics","title":"Statistical Metrics","text":"<p>Configurable metric computation (via <code>~/.statamcp/config.toml</code> or environment variables): - Default: observations, mean, standard error, minimum, maximum - Extended: Q1, Q3, skewness, kurtosis, unique value sampling</p>"},{"location":"overview/#caching-strategy","title":"Caching Strategy","text":"<p>Content-addressable cache using MD5 hashing:</p> <pre><code>~/.statamcp/.cache/data_info__&lt;name&gt;_&lt;ext&gt;__hash_&lt;suffix&gt;.json\n</code></pre> <p>Cache invalidation occurs automatically on content change detection.</p>"},{"location":"overview/#project-structure-convention","title":"Project Structure Convention","text":"<p>Stata-MCP enforces a standardized directory layout for reproducible research:</p> <pre><code>~/Documents/stata-mcp-folder/\n\u251c\u2500\u2500 stata-mcp-log/      # Stata execution logs (timestamped)\n\u251c\u2500\u2500 stata-mcp-dofile/   # Generated do-files (ISO 8601 timestamps)\n\u251c\u2500\u2500 stata-mcp-result/   # Command outputs (outreg2, esttab exports)\n\u2514\u2500\u2500 stata-mcp-tmp/      # Temporary artifacts (data info cache)\n</code></pre> <p>For AI-assisted research projects, the recommended template (<code>stata-mcp --init</code>) creates:</p> <pre><code>&lt;project_name&gt;/\n\u251c\u2500\u2500 .claude/\n\u2502   \u251c\u2500\u2500 skills/              # Custom Claude Code skills\n\u2502   \u2514\u2500\u2500 settings.local.json  # MCP server registration\n\u251c\u2500\u2500 source/\n\u2502   \u251c\u2500\u2500 data/\n\u2502   \u2502   \u251c\u2500\u2500 raw/             # Immutable source data\n\u2502   \u2502   \u251c\u2500\u2500 processing/      # Intermediate datasets\n\u2502   \u2502   \u2514\u2500\u2500 final/           # Analysis-ready data\n\u2502   \u251c\u2500\u2500 figs/                # Publication figures\n\u2502   \u2514\u2500\u2500 tabs/                # Publication tables\n\u251c\u2500\u2500 stata-mcp-folder/        # Stata-MCP working directory\n\u2514\u2500\u2500 CLAUDE.md                # Project-specific instructions\n</code></pre>"},{"location":"overview/#integration-patterns","title":"Integration Patterns","text":""},{"location":"overview/#in-ai-clients","title":"In AI Clients","text":"<p>MCP-compliant clients (Claude Code, Cline, Continue) register Stata-MCP as a server in their configuration:</p> <pre><code>{\n  \"mcpServers\": {\n    \"stata-mcp\": {\n      \"command\": \"uvx\",\n      \"args\": [\"stata-mcp\"]\n    }\n  }\n}\n</code></pre>"},{"location":"overview/#in-python-agents","title":"In Python Agents","text":"<p>Stata-MCP agents can be embedded as tools within other agent workflows:</p> <pre><code>from stata_mcp.agent_as import StataAgent\nfrom agents import Agent, Runner\n\n# Initialize Stata agent and convert to tool\nstata_agent = StataAgent()\nstata_tool = stata_agent.as_tool\n\n# Embed in a larger agent workflow\nresearch_assistant = Agent(\n    name=\"Research Assistant\",\n    instructions=\"You help with economic research using Stata\",\n    tools=[stata_tool]\n)\n\n# Run the agent\nresult = await Runner.run(\n    research_assistant,\n    \"Analyze the relationship between education and income\"\n)\n</code></pre>"},{"location":"overview/#terminal-repl","title":"Terminal REPL","text":"<p>Interactive analysis sessions:</p> <pre><code>from stata_mcp.agent_as import REPLAgent\n\nagent = REPLAgent(work_dir=\"~/analysis\")\nagent.run()  # Starts interactive REPL\n</code></pre>"},{"location":"overview/#cross-platform-support","title":"Cross-Platform Support","text":"Platform Stata Detection Package Installation Help System macOS <code>/Applications/Stata/StataMP</code> Native CLI \u2705 Cached Windows <code>Program Files</code> registry Do-file delegation \u274c Not supported Linux <code>stata-mp</code> from PATH Native CLI \u2705 Cached"},{"location":"overview/#design-philosophy","title":"Design Philosophy","text":"<ol> <li>Immutability: Source files remain unmodified; all operations create timestamped artifacts</li> <li>Fail-Safety: Graceful degradation (e.g., <code>append_dofile</code> creates new files if source missing)</li> <li>Reproducibility: Deterministic paths, automatic logging, and cache invalidation</li> <li>Extensibility: Plugin architecture for custom tools and data format handlers</li> <li>Security First:</li> <li>Security Guard: Blocks dangerous commands before execution</li> <li>Path Validation: Restricts file operations to working directory</li> <li>Resource Monitoring: Prevents memory exhaustion via RAM monitoring</li> <li>Sandboxed Execution: Isolated execution environments for safety</li> </ol>"},{"location":"overview/#advanced-features","title":"Advanced Features","text":""},{"location":"overview/#security-guard","title":"Security Guard \u2705","text":"<p>Automatically validates all dofile code against dangerous commands: - Blocks shell execution (<code>!</code>, <code>shell</code>, <code>xshell</code>, etc.) - Prevents file deletion operations (<code>erase</code>, <code>rm</code>) - Stops untrusted code execution (<code>run</code>, <code>do</code>, <code>include</code>) - Configurable via Security settings</p>"},{"location":"overview/#ram-monitoring","title":"RAM Monitoring \u2705","text":"<p>Real-time monitoring of Stata process memory usage: - Tracks RAM usage during execution - Automatically terminates processes exceeding limits - Configurable RAM limits per project - Minimal overhead with daemon thread architecture - See Monitoring documentation for details</p>"},{"location":"overview/#unified-configuration","title":"Unified Configuration \u2705","text":"<p>Hierarchical configuration system: - TOML-based configuration file (<code>~/.statamcp/config.toml</code>) - Environment variable overrides - Sections: DEBUG, SECURITY, PROJECT, MONITOR - See Configuration documentation for details</p>"},{"location":"overview/#sandbox-system-not-support-now","title":"Sandbox System (not support now)","text":"<p>Alternative execution backend using Jupyter kernels for environments without Stata licenses or for testing purposes.</p>"},{"location":"overview/#multi-language-support-not-support-now","title":"Multi-Language Support (not support now)","text":"<p>Configurable language settings for localized error messages and documentation.</p>"},{"location":"overview/#citation-and-acknowledgments","title":"Citation and Acknowledgments","text":"<p>Stata-MCP is developed by the empirical research community to bridge AI assistance with domain-specific analytical tools. Contributions, bug reports, and feature requests are welcome via the GitHub repository.</p>"},{"location":"security/","title":"Security Guard System","text":"<p>The Security Guard system provides protection against dangerous commands and operations in Stata dofiles. It acts as a safety layer between LLM-generated code and actual execution.</p>"},{"location":"security/#overview","title":"Overview","text":"<p>The Security Guard is enabled by default to prevent accidental execution of destructive operations. It validates all dofile code against a blacklist of dangerous commands and patterns before execution.</p>"},{"location":"security/#key-features","title":"Key Features","text":"<ul> <li>Blacklist-Based Validation: Blocks known dangerous commands</li> <li>Pattern Matching: Detects potentially dangerous operations using regex</li> <li>Line-by-Line Analysis: Provides detailed risk reporting with line numbers</li> <li>Configurable: Can be disabled if needed (not recommended)</li> <li>Zero False Positives for Safe Code: Only flags genuinely dangerous operations</li> </ul>"},{"location":"security/#dangerous-commands","title":"Dangerous Commands","text":"<p>The Security Guard blocks the following dangerous commands:</p>"},{"location":"security/#shell-execution-commands","title":"Shell Execution Commands","text":"Command Description Example <code>!</code> Unix-style shell escape <code>! ls -la</code> <code>!!</code> Extended shell command <code>!! vi file.do</code> <code>shell</code> Shell command execution <code>shell dir</code> <code>xshell</code> Extended shell for Mac/Unix(GUI) <code>xshell vi file.do</code> <code>winexec</code> Windows program execution <code>winexec notepad.exe</code> <code>unixcmd</code> Unix command execution <code>unixcmd ls</code>"},{"location":"security/#file-operations","title":"File Operations","text":"Command Description Risk <code>erase</code> File deletion Data loss <code>rm</code> File deletion (alias) Data loss <code>rmdir</code> Directory removal Data loss <code>copy</code> File copy Can overwrite files"},{"location":"security/#code-execution","title":"Code Execution","text":"Command Description Risk <code>run</code> Run another do-file Untrusted code execution <code>do</code> Execute do-file Untrusted code execution <code>include</code> Include another do-file Untrusted code execution"},{"location":"security/#configuration","title":"Configuration","text":""},{"location":"security/#enabledisable-security-guard","title":"Enable/Disable Security Guard","text":""},{"location":"security/#option-1-configuration-file","title":"Option 1: Configuration File","text":"<p>Edit <code>~/.statamcp/config.toml</code>:</p> <pre><code>[SECURITY]\nIS_GUARD = true  # Default: true\n</code></pre>"},{"location":"security/#option-2-environment-variable","title":"Option 2: Environment Variable","text":"<pre><code># Enable (default)\nexport STATA_MCP__IS_GUARD=true\n\n# Disable (not recommended)\nexport STATA_MCP__IS_GUARD=false\n</code></pre>"},{"location":"security/#default-behavior","title":"Default Behavior","text":"<ul> <li>Default: Enabled (<code>IS_GUARD = true</code>)</li> <li>Recommended: Keep enabled for production use</li> <li>Development: Can be disabled for testing (use with caution)</li> </ul>"},{"location":"security/#usage","title":"Usage","text":""},{"location":"security/#basic-usage","title":"Basic Usage","text":"<p>The Security Guard is automatically applied when using the <code>stata_do</code> tool:</p> <pre><code># When IS_GUARD is enabled (default)\nresult = stata_mcp.stata_do(code=\"\"\"\n    sysuse auto\n    regress price mpg weight\n\"\"\")\n\n# Safe code executes normally\n</code></pre>"},{"location":"security/#security-validation-example","title":"Security Validation Example","text":"<p>When dangerous code is detected:</p> <pre><code>result = stata_mcp.stata_do(code=\"\"\"\n    sysuse auto\n    ! rm -rf /  # Dangerous command\n\"\"\")\n\n# Error: Security validation failed\n# \u274c Security validation failed. Found dangerous items:\n#   - Line 3: command '!'\n</code></pre>"},{"location":"security/#programmatic-usage","title":"Programmatic Usage","text":"<p>If you're using Stata-MCP as a library:</p> <pre><code>from stata_mcp.guard import GuardValidator\n\n# Create validator\nvalidator = GuardValidator()\n\n# Validate code\ncode = \"\"\"\nsysuse auto\nregress price mpg weight\n\"\"\"\n\nreport = validator.validate(code)\n\nif report.is_safe:\n    print(\"\u2705 Code is safe to execute\")\nelse:\n    print(f\"\u274c Found {len(report.dangerous_items)} dangerous items:\")\n    for item in report.dangerous_items:\n        print(f\"  {item}\")\n</code></pre>"},{"location":"security/#security-report","title":"Security Report","text":""},{"location":"security/#securityreport-object","title":"SecurityReport Object","text":"<pre><code>@dataclass\nclass SecurityReport:\n    is_safe: bool                              # True if no dangerous items found\n    dangerous_items: List[RiskItem]            # List of detected risks\n</code></pre>"},{"location":"security/#riskitem-object","title":"RiskItem Object","text":"<pre><code>@dataclass\nclass RiskItem:\n    type: str                                  # \"command\" or \"pattern\"\n    content: str                               # The dangerous content\n    line: int                                  # Line number (1-indexed)\n</code></pre>"},{"location":"security/#example-output","title":"Example Output","text":"<pre><code># Safe code\nreport = validator.validate(\"sysuse auto\")\nprint(report)\n# Output: \u2705 Code passed security validation\n\n# Dangerous code\nreport = validator.validate(\"! rm file.txt\")\nprint(report)\n# Output:\n# \u274c Security validation failed. Found dangerous items:\n#   - Line 1: command '!'\n</code></pre>"},{"location":"security/#dangerous-patterns","title":"Dangerous Patterns","text":"<p>The Security Guard uses regex patterns to detect dangerous operations:</p>"},{"location":"security/#shell-command-patterns","title":"Shell Command Patterns","text":"<pre><code>r\"!\\s*\\w+\"           # Shell escape with command: ! ls\nr\"!!\\s*\\w+\"          # Extended shell: !! vi file.do\nr\"shell\\s+\\w+\"       # Shell command: shell dir\nr\"xshell\\s+\\w+\"      # Extended shell: xshell vi file.do\nr\"winexec\\s+\\S+\"     # Windows execution: winexec program.exe\nr\"unixcmd\\s+\\w+\"     # Unix command: unixcmd ls\n</code></pre>"},{"location":"security/#file-operation-patterns","title":"File Operation Patterns","text":"<pre><code>r\"erase\\s+.*\"        # File deletion: erase file.dta\nr\"rm\\s+.*\"           # File deletion: rm file.dta\nr\"rmdir\\s+.*\"        # Directory removal: rmdir mydir\nr\"copy\\s+.*\"         # File copy: copy file1.dta file2.dta\n</code></pre>"},{"location":"security/#code-execution-patterns","title":"Code Execution Patterns","text":"<pre><code>r\"run\\s+.*\"          # Run do-file: run script.do\nr\"\\bdo\\s+.*\"         # Execute do-file: do script.do\nr\"include\\s+.*\"      # Include do-file: include setup.do\n</code></pre>"},{"location":"security/#validation-process","title":"Validation Process","text":""},{"location":"security/#step-by-step-validation","title":"Step-by-Step Validation","text":"<ol> <li>Code Input: Receive dofile code string</li> <li>Line Split: Split code into lines for line number tracking</li> <li>Filtering: Skip empty lines and comments (starting with <code>*</code>)</li> <li>Command Check: Check each line against dangerous commands</li> <li>Pattern Check: Check each line against dangerous patterns</li> <li>Report Generation: Create SecurityReport with all findings</li> </ol>"},{"location":"security/#example-validation","title":"Example Validation","text":"<pre><code>code = \"\"\"\n* This is a comment\nsysuse auto\n! rm dangerous.txt  # Line 3\nregress price mpg\n\"\"\"\n\nreport = validator.validate(code)\n# Report:\n# \u274c Security validation failed. Found dangerous items:\n#   - Line 3: command '!'\n</code></pre>"},{"location":"security/#best-practices","title":"Best Practices","text":""},{"location":"security/#1-keep-security-guard-enabled","title":"1. Keep Security Guard Enabled","text":"<pre><code>[SECURITY]\nIS_GUARD = true  # Always keep enabled\n</code></pre>"},{"location":"security/#2-review-security-reports","title":"2. Review Security Reports","text":"<p>Always review security validation reports:</p> <pre><code>report = validator.validate(code)\nif not report.is_safe:\n    # Log or notify about dangerous items\n    for item in report.dangerous_items:\n        logger.warning(f\"Dangerous item found: {item}\")\n</code></pre>"},{"location":"security/#3-use-whitelist-for-allowed-operations","title":"3. Use Whitelist for Allowed Operations","text":"<p>If you need to execute certain dangerous operations:</p> <ol> <li>Review the code manually</li> <li>Remove dangerous commands</li> <li>Use safe alternatives</li> </ol> <p>Example:</p> <pre><code>* Instead of: ! rm tempfile.dta\n* Use: erase tempfile.dta  (still blocked, but shows intent)\n\n* Better approach: Use Stata's built-in safe operations\ncapture erase tempfile.dta\n</code></pre>"},{"location":"security/#4-educate-users","title":"4. Educate Users","text":"<p>Document which commands are blocked and why:</p> <pre><code>## Blocked Commands\n\nThe following commands are blocked for security reasons:\n- Shell commands (!, shell, xshell, etc.)\n- File deletion (erase, rm)\n- External code execution (run, do, include)\n\nPlease use safe alternatives or contact administrator for assistance.\n</code></pre>"},{"location":"security/#troubleshooting","title":"Troubleshooting","text":""},{"location":"security/#false-positives","title":"False Positives","text":"<p>If you believe a command is incorrectly flagged:</p> <ol> <li>Review the command: Is it actually dangerous?</li> <li>Check for patterns: Does it match a dangerous pattern?</li> <li>Consider alternatives: Is there a safer way to accomplish the task?</li> </ol>"},{"location":"security/#disabling-security-guard","title":"Disabling Security Guard","text":"<p>\u26a0\ufe0f Warning: Disabling the Security Guard is not recommended.</p> <p>Only disable if: - You're in a trusted environment - All code is manually reviewed - You understand the risks</p> <pre><code># Temporary disable (current session only)\nexport STATA_MCP__IS_GUARD=false\nstata-mcp\n\n# Permanent disable (add to config)\n# Edit ~/.statamcp/config.toml\n[SECURITY]\nIS_GUARD = false\n</code></pre>"},{"location":"security/#customizing-blacklist","title":"Customizing Blacklist","text":"<p>You can extend the blacklist by modifying the code:</p> <pre><code>from stata_mcp.guard.blacklist import DANGEROUS_COMMANDS\n\n# Add custom dangerous commands\nDANGEROUS_COMMANDS.add(\"my_dangerous_command\")\n\n# Use custom validator\nfrom stata_mcp.guard import GuardValidator\nvalidator = GuardValidator()\nvalidator.dangerous_commands.add(\"another_command\")\n</code></pre>"},{"location":"security/#security-considerations","title":"Security Considerations","text":""},{"location":"security/#what-the-guard-protects-against","title":"What the Guard Protects Against","text":"<p>\u2705 Prevents: - Shell command execution - File deletion operations - Untrusted code execution - System-level operations</p> <p>\u274c Does Not Prevent: - Data modification within Stata - Infinite loops - Memory exhaustion - Stata crashes</p>"},{"location":"security/#limitations","title":"Limitations","text":"<p>The Security Guard: - Does not analyze data flow - Does not track variable values - Does not prevent resource exhaustion - Is not a substitute for proper code review</p>"},{"location":"security/#defense-in-depth","title":"Defense in Depth","text":"<p>The Security Guard is one layer of protection. Combine with:</p> <ol> <li>Monitoring: Enable RAM monitoring (see Monitoring Documentation)</li> <li>Sandboxing: Use isolated environments for untrusted code</li> <li>Code Review: Manually review generated code</li> <li>Backups: Maintain regular backups of important data</li> </ol>"},{"location":"security/#integration-with-mcp-tools","title":"Integration with MCP Tools","text":""},{"location":"security/#automatic-integration","title":"Automatic Integration","text":"<p>The Security Guard is automatically integrated with:</p> <ul> <li><code>stata_do</code>: Execute Stata do-files (validated by default)</li> <li><code>write_dofile</code>: Create do-files (not validated until execution)</li> <li><code>append_dofile</code>: Append to do-files (not validated until execution)</li> </ul>"},{"location":"security/#validation-flow","title":"Validation Flow","text":"<pre><code>User Request \u2192 MCP Tool \u2192 Security Guard \u2192 Validation\n                                      \u2193\n                                 Pass? \u2192 Execute\n                                      \u2193\n                                 Fail? \u2192 Return Error\n</code></pre>"},{"location":"security/#extensibility","title":"Extensibility","text":""},{"location":"security/#creating-custom-validators","title":"Creating Custom Validators","text":"<p>You can create custom validators for specific use cases:</p> <pre><code>from stata_mcp.guard import GuardValidator, RiskItem, SecurityReport\n\nclass CustomValidator(GuardValidator):\n    \"\"\"Custom validator with additional rules.\"\"\"\n\n    def validate(self, code: str) -&gt; SecurityReport:\n        # Get base validation results\n        report = super().validate(code)\n\n        # Add custom validation logic\n        if \"custom_dangerous_thing\" in code:\n            report.dangerous_items.append(\n                RiskItem(\n                    type=\"custom\",\n                    content=\"custom_dangerous_thing\",\n                    line=code.find(\"custom_dangerous_thing\")\n                )\n            )\n            report.is_safe = False\n\n        return report\n</code></pre>"},{"location":"security/#combining-multiple-validators","title":"Combining Multiple Validators","text":"<pre><code>from stata_mcp.guard import GuardValidator\n\n# Create multiple validators\nbasic_validator = GuardValidator()\ncustom_validator = CustomValidator()\n\n# Validate with both\ncode = \"some stata code\"\nreport1 = basic_validator.validate(code)\nreport2 = custom_validator.validate(code)\n\n# Combine results\nif report1.is_safe and report2.is_safe:\n    print(\"\u2705 All validations passed\")\n</code></pre>"},{"location":"security/#examples","title":"Examples","text":""},{"location":"security/#example-1-safe-code-execution","title":"Example 1: Safe Code Execution","text":"<pre><code>from stata_mcp.guard import GuardValidator\n\nvalidator = GuardValidator()\n\nsafe_code = \"\"\"\n* Load sample data\nsysuse auto\n\n* Run regression\nregress price mpg weight\n\n* Display results\ndisplay \"R-squared: \" + string(e(r2))\n\"\"\"\n\nreport = validator.validate(safe_code)\nprint(report)\n# Output: \u2705 Code passed security validation\n</code></pre>"},{"location":"security/#example-2-dangerous-code-detection","title":"Example 2: Dangerous Code Detection","text":"<pre><code>dangerous_code = \"\"\"\nsysuse auto\n\n* This will be blocked\n! rm -rf /important/data\n\nregress price mpg\n\"\"\"\n\nreport = validator.validate(dangerous_code)\nprint(report)\n# Output:\n# \u274c Security validation failed. Found dangerous items:\n#   - Line 5: command '!'\n</code></pre>"},{"location":"security/#example-3-multiple-violations","title":"Example 3: Multiple Violations","text":"<pre><code>multiple_violations = \"\"\"\nsysuse auto\nshell delete file.txt\nrun untrusted_script.do\n\"\"\"\n\nreport = validator.validate(multiple_violations)\nprint(f\"Found {len(report.dangerous_items)} violations:\")\nfor item in report.dangerous_items:\n    print(f\"  {item}\")\n# Output:\n# Found 2 violations:\n#   Line 3: command 'shell'\n#   Line 4: pattern 'run\\s+.*'\n</code></pre>"},{"location":"security/#summary","title":"Summary","text":"<p>The Security Guard system provides essential protection for automated Stata execution:</p> <ul> <li>\u2705 Enabled by default for safety</li> <li>\u2705 Blocks dangerous commands (shell, file deletion, etc.)</li> <li>\u2705 Pattern-based detection for comprehensive coverage</li> <li>\u2705 Detailed reporting with line numbers</li> <li>\u2705 Configurable for different use cases</li> <li>\u2705 Zero overhead when disabled (not recommended)</li> </ul> <p>For production use, always keep the Security Guard enabled and review validation reports regularly.</p>"},{"location":"usage/","title":"Usage Guide","text":"<p>Hope no Star War future. - Let's evolve from reg monkeys to causal thinkers.</p> <p>This guide covers how to integrate and use Stata-MCP across different environments and agents.</p>"},{"location":"usage/#prerequisites","title":"Prerequisites","text":"<p>Before using Stata-MCP, ensure you have: - Stata 17+ installed with a valid license - uv package manager or Python 3.11+ - Stata-MCP installed or available via <code>uvx</code></p> <p>Verify your setup:</p> <pre><code>uvx stata-mcp --usable\n</code></pre>"},{"location":"usage/#new-features","title":"New Features","text":""},{"location":"usage/#security-guard-system","title":"\ud83d\udd12 Security Guard System","text":"<p>Stata-MCP now includes automatic security validation to prevent dangerous commands:</p> <pre><code># Automatically enabled by default\n# Blocks: !, shell, erase, rm, run, do, include, etc.\n\n# Safe code executes normally\nresult = stata_mcp.stata_do(\"\"\"\n    sysuse auto\n    regress price mpg weight\n\"\"\")\n\n# Dangerous code is blocked\nresult = stata_mcp.stata_do(\"\"\"\n    ! rm -rf /  # \u274c Blocked by security guard\n\"\"\")\n# Error: Security validation failed\n</code></pre> <p>Configuration:</p> <pre><code># ~/.statamcp/config.toml\n[SECURITY]\nIS_GUARD = true  # Default: true\n</code></pre> <p>Environment Variable:</p> <pre><code>export STATA_MCP__IS_GUARD=true\n</code></pre> <p>For details, see Security Documentation.</p>"},{"location":"usage/#ram-monitoring-system","title":"\ud83d\udcca RAM Monitoring System","text":"<p>Monitor and control Stata process memory usage:</p> <pre><code># Enable monitoring with 8GB limit\nexport STATA_MCP__IS_MONITOR=true\nexport STATA_MCP__RAM_LIMIT=8192\n\n# Process is automatically terminated if RAM exceeds limit\nresult = stata_mcp.stata_do(large_analysis_code)\n</code></pre> <p>Configuration:</p> <pre><code>[MONITOR]\nIS_MONITOR = false   # Default: false\nMAX_RAM_MB = -1      # -1 = no limit, positive value = limit in MB\n</code></pre> <p>For details, see Monitoring Documentation.</p>"},{"location":"usage/#unified-configuration-system","title":"\u2699\ufe0f Unified Configuration System","text":"<p>Configure all settings via TOML file or environment variables:</p> <p>Priority: Environment variables &gt; config file &gt; defaults</p> <pre><code># Quick setup with environment variables\nexport STATA_MCP__CWD=\"/projects/my-analysis\"\nexport STATA_MCP__IS_GUARD=true\nexport STATA_MCP__IS_MONITOR=true\nexport STATA_MCP__RAM_LIMIT=16384\n</code></pre> <p>Or use config file (<code>~/.statamcp/config.toml</code>):</p> <pre><code>[DEBUG]\nIS_DEBUG = false\n\n[DEBUG.logging]\nLOGGING_ON = true\nLOGGING_CONSOLE_HANDLER_ON = false\nLOGGING_FILE_HANDLER_ON = true\n\n[SECURITY]\nIS_GUARD = true\n\n[PROJECT]\nWORKING_DIR = \"\"\n\n[MONITOR]\nIS_MONITOR = false\nMAX_RAM_MB = -1\n</code></pre> <p>For details, see Configuration Documentation.</p>"},{"location":"usage/#usage-in-python","title":"Usage in Python","text":""},{"location":"usage/#using-openai-agents-sdk","title":"Using OpenAI Agents SDK","text":"<p>Stata-MCP can be integrated with Python agents using the OpenAI Agents SDK.</p>"},{"location":"usage/#method-1-direct-mcp-server-integration","title":"Method 1: Direct MCP Server Integration","text":"<pre><code># !uv pip install openai-agents\nfrom agents import Agent, Runner\nfrom agents.mcp import MCPServerStdio, MCPServerStdioParams\n\n# Create MCP server connection\nstata_mcp_server = MCPServerStdio(\n    name=\"Stata-MCP\",\n    params=MCPServerStdioParams(\n        command=\"uvx\",\n        args=[\"stata-mcp\"]\n    )\n)\n\n# Initialize agent with MCP server\nagent = Agent(\n    name=\"Research Assistant\",\n    instructions=\"You are a helpful economics research assistant.\",\n    mcp_servers=[stata_mcp_server]\n)\n\n# Run analysis\nresult = await Runner.run(\n    agent,\n    input=\"Run a regression: log(wage) ~ age, educ, exper with nlsw88 data and report coefficients.\"\n)\n\nprint(f\"Result: \\n&gt; {result.final_output}\")\n</code></pre>"},{"location":"usage/#method-2-pre-configured-stataagent","title":"Method 2: Pre-configured StataAgent","text":"<pre><code># !uv pip install stata-mcp\nfrom agents import Runner\nfrom stata_mcp.agent_as import StataAgent\n\n# Use pre-configured Stata agent\nagent = StataAgent()\nresult = await Runner.run(\n    agent,\n    input=\"Help me run a regression -&gt; log(wage) ~ age, educ, exper with `nlsw88` data and report me the coefficients.\"\n)\nprint(f\"Result: \\n&gt; {result.final_output}\")\n</code></pre>"},{"location":"usage/#agent-as-tool","title":"Agent as Tool","text":"<p>Embed Stata-MCP as a tool within larger agent workflows:</p> <pre><code># !uv pip install openai-agents stata-mcp\nfrom agents import Agent, Runner\nfrom stata_mcp.agent_as import StataAgent\n\n# Create Stata agent and convert to tool\nstata_agent = StataAgent(max_turns=100)\nstata_tool = stata_agent.as_tool\n\n# Embed in a larger research workflow\nresearcher = Agent(\n    name=\"Scientific Researcher\",\n    instructions=\"You are a helpful scientist conducting empirical research.\",\n    tools=[stata_tool]\n)\n\n# Run the composed agent\nresult = await Runner.run(\n    researcher,\n    input=\"Analyze the relationship between education and wages using standard datasets.\"\n)\n</code></pre>"},{"location":"usage/#usage-in-coding-agents","title":"Usage in Coding Agents","text":"<p>Stata-MCP is designed for seamless integration with modern AI coding agents. Below are tested configurations for popular platforms.</p>"},{"location":"usage/#claude-plugin-recommended","title":"Claude Plugin (Recommended)","text":"<p>We recommend using the official plugin for the best experience. Therefore the simplest way to use Stata-MCP with Claude Code is through the official plugin, which provides both MCP server and LSP integration:</p> <pre><code># Add marketplace registry\nclaude plugin marketplace add sepinetam/stata-mcp\n\n# Install plugin globally\nclaude plugin install stata-toolbox -s user\n</code></pre> <p>If you want to work with your partners, also could install it with: </p> <pre><code># claude plugin marketplace add sepinetam/stata-mcp\n\nclaude plugin install stata-toolbox@stata-plugin-lib -s project\n</code></pre> <p>Then, you can find the plugin in <code>.claude/settings.json</code> with</p> <pre><code>{\n  \"enabledPlugins\": {\n    \"stata-toolbox@stata-plugin-lib\": true\n  }\n}\n</code></pre> <p>Plugin Features: - \u2705 One-command installation - \u2705 MCP server + LSP configured together - \u2705 Pre-configured optimal Stata LSP settings</p> <p>For complete plugin documentation, see Claude Plugin Guide.</p>"},{"location":"usage/#manual-mcp-configuration-for-claude-code","title":"Manual MCP Configuration for Claude Code","text":"<p>Alternatively, configure MCP server manually:</p> <p>Claude Code is our recommended solution for AI-assisted empirical research.</p>"},{"location":"usage/#global-installation","title":"Global Installation","text":"<pre><code>claude mcp add stata-mcp -- uvx stata-mcp\n</code></pre>"},{"location":"usage/#project-based-configuration","title":"Project-based Configuration","text":"<p>For research projects, use project-scoped configuration:</p> <pre><code>cd ~/Documents/MyResearchProject\nclaude mcp add stata-mcp --env STATA_MCP_CWD=$(pwd) --scope project -- uvx --directory $(pwd) stata-mcp\n</code></pre>"},{"location":"usage/#specify-version","title":"Specify Version","text":"<p>To use a specific version:</p> <pre><code>claude mcp add stata-mcp --env STATA_MCP_CWD=$(pwd) --scope project -- uvx --directory $(pwd) stata-mcp==1.13.0\n</code></pre> <p>Verify installation:</p> <pre><code>claude mcp list\n</code></pre> <p>Benefits of project-based configuration: - Isolates Stata-MCP environment per research project - Automatic path management within project directory - No global configuration conflicts</p>"},{"location":"usage/#codex-vs-code-extension","title":"Codex (VS Code Extension)","text":"<p>For VS Code users with the Codex extension, edit <code>~/.codex/config.toml</code>:</p> <pre><code>[mcp_servers.stata-mcp]\ncommand = \"uvx\"\nargs = [\"stata-mcp\"]\n</code></pre>"},{"location":"usage/#cline","title":"Cline","text":"<p>For Cline users, edit the MCP configuration file at <code>~/Library/Application Support/Code/User/globalStorage/saoudrizwan.claude-dev/setting/cline_mcp_settings.json</code>:</p> <pre><code>{\n  \"mcpServers\": {\n    \"stata-mcp\": {\n      \"command\": \"uvx\",\n      \"args\": [\n        \"stata-mcp\"\n      ]\n    }\n  }\n}\n</code></pre>"},{"location":"usage/#cursor","title":"Cursor","text":"<p>Note: Cursor has limited file system access. MCP servers may not access <code>Documents</code> directory by default. If you encounter issues, try this configuration:</p> <pre><code>{\n  \"mcpServers\": {\n    \"stata-mcp\": {\n      \"command\": \"uvx\",\n      \"args\": [\n        \"stata-mcp\"\n      ],\n      \"env\": {\n        \"STATA_MCP_CWD\": \"/path/to/your/project\"\n      }\n    }\n  }\n}\n</code></pre> <p>Replace <code>/path/to/your/project</code> with your actual research directory.</p>"},{"location":"usage/#usage-in-ai-clients","title":"Usage in AI Clients","text":"<p>Most AI clients follow the standard MCP server configuration format. Below is the universal configuration pattern:</p>"},{"location":"usage/#standard-configuration-claude-desktop-cherry-studio-etc","title":"Standard Configuration (Claude Desktop, Cherry Studio, etc.)","text":"<pre><code>{\n  \"mcpServers\": {\n    \"stata-mcp\": {\n      \"command\": \"uvx\",\n      \"args\": [\n        \"stata-mcp\"\n      ]\n    }\n  }\n}\n</code></pre>"},{"location":"usage/#configuration-with-custom-working-directory","title":"Configuration with Custom Working Directory","text":"<pre><code>{\n  \"mcpServers\": {\n    \"stata-mcp\": {\n      \"command\": \"uvx\",\n      \"args\": [\n        \"stata-mcp\"\n      ],\n      \"env\": {\n        \"STATA_MCP_CWD\": \"/path/to/working/directory\"\n      }\n    }\n  }\n}\n</code></pre>"},{"location":"usage/#configuration-with-environment-variables","title":"Configuration with Environment Variables","text":"<pre><code>{\n  \"mcpServers\": {\n    \"stata-mcp\": {\n      \"command\": \"uvx\",\n      \"args\": [\n        \"stata-mcp\"\n      ],\n      \"env\": {\n        \"STATA_MCP_CWD\": \"/path/to/working/directory\",\n        \"STATA_MCP_MODEL\": \"gpt-4\",\n        \"STATA_MCP_API_KEY\": \"your-api-key\",\n        \"STATA_MCP_API_BASE_URL\": \"https://api.openai.com/v1\"\n      }\n    }\n  }\n}\n</code></pre>"},{"location":"usage/#environment-variables","title":"Environment Variables","text":"<p>Stata-MCP supports several environment variables for customization:</p> Variable Description Default <code>STATA_MCP_CWD</code> Current working directory for Stata operations <code>./</code> <code>STATA_MCP_MODEL</code> LLM model for agent mode <code>gpt-3.5-turbo</code> <code>STATA_MCP_API_KEY</code> API key for LLM provider <code>OPENAI_API_KEY</code> <code>STATA_MCP_API_BASE_URL</code> Base URL for API requests <code>https://api.openai.com/v1</code> <code>STATA_MCP_CLIENT</code> Client type identifier -"},{"location":"usage/#terminal-repl-mode","title":"Terminal REPL Mode","text":"<p>For interactive sessions, use the built-in REPL agent:</p> <pre><code># Start with current directory\nuvx stata-mcp agent run\n\n# Start with custom working directory\nuvx stata-mcp agent run ~/Documents/MyResearch\n</code></pre> <p>Usage: - Type your research questions in natural language - Agent maintains conversation context - Type <code>/exit</code> or <code>bye</code> to quit</p>"},{"location":"usage/#advanced-usage","title":"Advanced Usage","text":""},{"location":"usage/#custom-agent-instructions","title":"Custom Agent Instructions","text":"<p>Create a custom StataAgent with specific instructions:</p> <pre><code>from stata_mcp.agent_as import StataAgent\n\nagent = StataAgent(\n    instructions=\"\"\"\n    You are a labor economics specialist.\n    Focus on causal inference methods like DID, RDD, and IV.\n    Always robustness checks and placebo tests.\n    \"\"\",\n    max_turns=50\n)\n</code></pre>"},{"location":"usage/#session-management","title":"Session Management","text":"<p>REPLAgent supports SQLite-based session persistence:</p> <pre><code>from stata_mcp.agent_as import REPLAgent\n\nagent = REPLAgent(\n    work_dir=\"~/research\",\n    session_id=\"my_experiment_1\"  # Optional custom session ID\n)\n</code></pre> <p>Sessions are stored in <code>&lt;work_dir&gt;/.stata_sessions.db</code> for conversation history.</p>"},{"location":"usage/#troubleshooting","title":"Troubleshooting","text":""},{"location":"usage/#common-issues","title":"Common Issues","text":"<p>\"Stata not found\" - Verify Stata installation: <code>which stata</code> (macOS/Linux) or check PATH - Use <code>StataFinder</code> configuration guide for custom paths</p> <p>\"Module not found\" errors - Ensure dependencies: <code>uv pip install openai-agents stata-mcp</code> - Check Python version: 3.11+ required</p> <p>MCP server not connecting - Verify <code>uvx stata-mcp --usable</code> passes all checks - Check client's MCP server logs - Test with stdio transport (default)</p>"},{"location":"usage/#debug-mode","title":"Debug Mode","text":"<p>Enable verbose logging:</p> <pre><code>export STATA_MCP__IS_DEBUG=true\nuvx stata-mcp agent run\n</code></pre>"},{"location":"usage/#best-practices","title":"Best Practices","text":"<ol> <li>Project Structure: Use project-scoped MCP configuration for better isolation</li> <li>Version Pinning: Specify exact versions in production: <code>stata-mcp==1.13.0</code></li> <li>Data Management: Keep raw data immutable; use processing/ directories</li> <li>Session Cleanup: Regularly archive or cleanup old SQLite session databases</li> <li>API Keys: Use environment variables, never hardcode credentials</li> </ol>"},{"location":"usage/#additional-resources","title":"Additional Resources","text":"<ul> <li>Overview - Architecture and design</li> <li>Tools Documentation - Available MCP tools</li> <li>Agents Guide - Agent-specific documentation</li> <li>GitHub Repository - Source code and issues</li> </ul>"},{"location":"usage/#contributing","title":"Contributing","text":"<p>Found a bug or have a feature request? Please open an issue or submit a pull request.</p>"},{"location":"agents/","title":"Use in Agent","text":"<p>Stata-MCP was designed with agents in mind from the outset. I believe the three core elements of an agent are tools, knowledge, and foundation models. The Stata manipulation capabilities provided by Stata-MCP serve as a core tool in our exploration of AI for social science.</p>"},{"location":"agents/claude_code/","title":"Use in Claude Code","text":"<p>We are very excited to write this document about Claude Code with Stata-MCP. At my daily research, Claude Code is one of the tools I use most often. </p> <p>If you have not installed it, you can visit Claude Code to install it. </p> <p>Requirements: - Stata 17+ - uv or python 3.11+ - Claude Code</p>"},{"location":"agents/claude_code/#quickly-start","title":"Quickly Start","text":"<p>First, check whether Stata-MCP is compatible with your device by verifying each requirement. </p> <pre><code>uvx stata-mcp --usable\n</code></pre> <p>Then, create your project. We suggest creating all the projects in the same directory. For example, we use <code>~/Documents/StataProjects</code> as the project directory.</p> <pre><code>cd ~/Documents/StataProjects\nclaude mcp add stata-mcp --env STATA_MCP_CWD=$(pwd) --scope project -- uvx --directory $(pwd) stata-mcp\n</code></pre> <p>Advice: Please make sure the directory without any special characters like whitespace, emoji or Chinese characters.</p> <p>Now the project has been created successfully.  The project structure is as follows:</p> <pre><code>my_first_project/            # Project directory\n\u251c\u2500\u2500 stata-mcp-folder/        # All the files generated by Stata-MCP\n\u2502   \u251c\u2500\u2500 stata-mcp-dofile/    # do-files\n\u2502   \u251c\u2500\u2500 stata-mcp-log/       # log files\n\u2502   \u251c\u2500\u2500 stata-mcp-result/    # Some command (like `outreg2`) results saved here\n\u2502   \u2514\u2500\u2500 stata-mcp-tmp/       # Temporary files, like data info description\n\u2502   \u2514\u2500\u2500 .gitignore           # git ignore file\n\u2514\u2500\u2500 CLAUDE.md                # The global instructions to limit the project\n\n</code></pre>"},{"location":"core/stata/do/","title":"Stata Do File Executor","text":""},{"location":"core/stata/do/#overview","title":"Overview","text":"<p>StataDo is the core module in Stata-MCP responsible for executing Stata do files. It provides a secure and reliable way to run Stata scripts with automatic result logging, supporting three major operating systems: macOS, Linux, and Windows.</p>"},{"location":"core/stata/do/#key-features","title":"Key Features","text":""},{"location":"core/stata/do/#cross-platform-support","title":"Cross-Platform Support","text":"<p>StataDo automatically adapts to different operating systems:</p> <ul> <li>Unix-like Systems (macOS/Linux): Interacts with Stata through standard input stream for efficient command execution</li> <li>Windows Systems: Uses batch file method to execute Stata commands, ensuring compatibility</li> </ul>"},{"location":"core/stata/do/#automatic-logging","title":"Automatic Logging","text":"<p>Every time a do file is executed, StataDo automatically:</p> <ol> <li>Creates a new log file or creates a log at the specified path</li> <li>Records the complete Stata execution process and output results</li> <li>Saves log files in the <code>stata-mcp-log</code> directory for easy review and analysis</li> </ol>"},{"location":"core/stata/do/#security-guarantees","title":"Security Guarantees","text":"<p>StataDo includes built-in security check mechanisms:</p> <ul> <li>Command Filtering: Blocks shell-escape commands that may compromise system security (such as <code>!cmd</code> or <code>shell cmd</code>)</li> <li>Content Validation: Checks do file content before execution to prevent malicious command execution</li> </ul>"},{"location":"core/stata/do/#smart-terminal-emulation","title":"Smart Terminal Emulation","text":"<p>StataDo simulates a standard terminal environment to ensure consistent and readable Stata output:</p> <ul> <li>Sets fixed terminal dimensions (120 columns \u00d7 40 lines)</li> <li>Ensures cross-platform output consistency</li> </ul>"},{"location":"core/stata/do/#workflow","title":"Workflow","text":"<ol> <li>Preparation Phase: Accepts do file path and log file path parameters</li> <li>Security Check: Validates do file content to ensure no dangerous commands</li> <li>Environment Adaptation: Selects appropriate execution method based on operating system type</li> <li>Script Execution: Calls Stata CLI to execute the do file</li> <li>Result Logging: Writes execution process and results to log file</li> <li>Cleanup: Removes temporary files (Windows platform)</li> </ol>"},{"location":"core/stata/do/#use-cases","title":"Use Cases","text":"<p>StataDo is primarily used in the following scenarios:</p> <ul> <li>Batch Data Processing: Executes do files containing data cleaning, transformation, and other operations</li> <li>Statistical Analysis: Runs regression analysis, descriptive statistics, and other Stata commands</li> <li>Chart Generation: Executes Stata scripts that generate statistical charts</li> <li>Automated Research Workflows: Calls Stata for data analysis in AI Agents or automated scripts</li> </ul>"},{"location":"core/stata/do/#integration-with-other-modules","title":"Integration with Other Modules","text":"<p>StataDo is an important part of the Stata-MCP toolchain:</p> <ul> <li>StataFinder: Provides the path to the Stata executable</li> <li>StataController: Provides higher-level Stata control interfaces</li> <li>Logging System: Automatically records execution results in the specified log directory</li> </ul>"},{"location":"core/stata/do/#file-path-conventions","title":"File Path Conventions","text":"<p>StataDo follows the Stata-MCP directory structure conventions:</p> <ul> <li>Do File Directory: <code>~/Documents/stata-mcp-folder/stata-mcp-dofile/</code></li> <li>Log File Directory: <code>~/Documents/stata-mcp-folder/stata-mcp-log/</code></li> </ul>"},{"location":"core/stata/do/#important-notes","title":"Important Notes","text":"<ol> <li>File Encoding: StataDo reads do files using UTF-8 encoding; ensure your do files are saved with UTF-8 encoding</li> <li>Path Handling: On Windows systems, spaces in paths are automatically handled</li> <li>Log Overwriting: By default, existing log files will be overwritten; this behavior can be controlled via parameters</li> <li>Error Handling: Exceptions are thrown when execution fails; callers should properly handle these exceptions</li> </ol>"},{"location":"core/stata/finder/","title":"Stata Finder","text":""},{"location":"core/stata/finder/#how-it-works","title":"How It Works","text":"<p>Since most users install Stata in default locations, we created the StataFinder module to automatically locate Stata executables on your device, allowing for a seamless experience in most cases.</p>"},{"location":"core/stata/finder/#detection-flow","title":"Detection Flow","text":"<ol> <li>Environment Variable Priority: First checks if the <code>STATA_CLI</code> environment variable is set; if set, uses it directly</li> <li>Automatic Detection: If no environment variable is set, automatically searches for Stata based on the operating system</li> <li>Version Selection: When multiple Stata versions are found, automatically selects the highest priority version</li> </ol>"},{"location":"core/stata/finder/#platform-differences","title":"Platform Differences","text":"<ul> <li>macOS: Searches <code>/usr/local/bin</code> directory and Stata.app in <code>/Applications</code></li> <li>Windows: Searches default installation paths (Program Files) and all available drives</li> <li>Linux: Searches <code>/usr/local/bin</code> and its subdirectories containing \"stata\"</li> </ul>"},{"location":"core/stata/finder/#version-priority","title":"Version Priority","text":"<p>When multiple Stata versions exist on the system, selection rules are as follows:</p> <ol> <li>Edition Type: MP &gt; SE &gt; BE &gt; IC &gt; default</li> <li>Version Number: Within the same edition type, selects the higher version (e.g., Stata 19 &gt; Stata 18)</li> </ol>"},{"location":"core/stata/finder/#not-found","title":"Not Found?","text":"<p>If <code>uvx stata-mcp --usable</code> remind you not found your Stata, don't worry. If you are sure about you have Stata on your device, follow the steps bellow to solve it. </p>"},{"location":"core/stata/finder/#macos","title":"macOS","text":"<ol> <li>Open your <code>Stata.app</code>, you can find <code>Stata/MP 19.0</code> or other similar version at the right of Apple logo, click it. </li> <li>Then, click <code>install terminal utility</code>. </li> <li>Now, you can close Stata, and run <code>uvx stata-mcp --usable</code> again. </li> <li>If there is still <code>not found</code>, you can open your <code>terminal</code> and run <code>which stata-mp</code> (or if your version is StataSE or StataBE, you can relace <code>stata-mp</code> with <code>stata-se</code> or <code>stata-be</code>). </li> <li>Set environment variable <code>STATA_CLI</code> to the path you got from step 4.</li> </ol> <p>for example: </p> <pre><code>sepinetam@sepine-macbook ~ % which stata-mp\n/usr/local/bin/stata-mp\nsepinetam@sepine-macbook ~ % export STATA_CLI=\"/usr/local/bin/stata-mp\"\nsepinetam@sepine-macbook ~ % uvx stata-mcp --usable\n\n===== Stata MCP Configuration Check =====\n\nOperating system (Current: macOS): \u2705 PASSED\nPython version (Current: 3.13.5): \u2705 PASSED\nMCP library installation: \u2705 PASSED\nLocating Stata CLI...\nStata CLI (Path: /usr/local/bin/stata-mp): \u2705 PASSED\nTesting Stata execution...\nStata execution test: \u2705 PASSED\n\nChecking required directories...\nBase Dir (Path: /Users/sepinetam/Documents/stata-mcp-folder): \u2705 PASSED\nLog Dir (Path: /Users/sepinetam/Documents/stata-mcp-folder/stata-mcp-log): \u2705 PASSED\nDofile Dir (Path: /Users/sepinetam/Documents/stata-mcp-folder/stata-mcp-dofile): \u2705 PASSED\nResult Dir (Path: /Users/sepinetam/Documents/stata-mcp-folder/stata-mcp-result): \u2705 PASSED\n\n===== Summary =====\n\n\u2705 Success! Your Stata-MCP setup is ready to use.\nYou can now use Stata-MCP with your preferred MCP client (Claude, Cherry Studio, etc.)\n</code></pre> <p>More over, write the config into <code>~/.zshrc</code> like this:</p> <pre><code>cat &gt;&gt; ~/.zshrc &lt;&lt;'EOF'\n# Stata CLI path\nexport STATA_CLI=\"$(command -v stata-mp 2&gt;/dev/null)\"\nEOF\n\nsource ~/.zshrc\necho \"$STATA_CLI\"\n</code></pre>"},{"location":"core/stata/finder/#linux","title":"Linux","text":"<ol> <li>If you're using a Linux machine without a GUI, you should know where your <code>stata-mp</code> executable is located, and I'll assume you're an experienced computer user.</li> <li>Simply set the environment variable <code>STATA_CLI</code> to your <code>stata-mp</code> executable path, then run <code>uvx stata-mcp --usable</code> again. If there are no errors, the configuration is successful.</li> </ol>"},{"location":"core/stata/finder/#windows","title":"Windows","text":"<p>Windows configuration is relatively more complex, but the core approach is similar to macOS and Linux. You need to find your <code>Stata.exe</code> (or similarly named) file, then set the <code>Stata.exe</code> path to the environment variable <code>STATA_CLI</code>. There are many online resources about how to set environment variables in Windows, so you can search for that yourself. Here's how to find the actual <code>Stata.exe</code> file: 1. Press the Windows key on your keyboard, search for \"Stata\", and find the Stata you're using. 2. Right-click and select \"Open file location\". At this point, there will usually be only two files in this directory - these are not the actual executable files. Right-click and select \"Open file location again\" to find the real executable file, then set its path to the environment variable <code>STATA_CLI</code>. 3. Run <code>uvx stata-mcp --usable</code> again. If there are no errors, the configuration is successful.</p>"},{"location":"core/stata/help/","title":"Stata Help","text":"<p>macOS and Linux Only!</p> <p>This module is currently only supported on macOS and Linux systems. Windows support is not available at this time.</p>"},{"location":"core/stata/help/#overview","title":"Overview","text":"<p>StataHelp is a utility module that retrieves help documentation for Stata commands directly from your local Stata installation. It provides quick access to Stata's built-in help system with intelligent caching for improved performance.</p>"},{"location":"core/stata/help/#key-features","title":"Key Features","text":""},{"location":"core/stata/help/#local-help-access","title":"Local Help Access","text":"<p>StataHelp queries the Stata help system installed on your machine:</p> <ul> <li>No Internet Required: All help documentation comes from your local Stata installation</li> <li>Fast Access: Retrieves help information instantly through Stata CLI</li> <li>Complete Documentation: Access the same comprehensive help available in Stata</li> </ul>"},{"location":"core/stata/help/#intelligent-caching-system","title":"Intelligent Caching System","text":"<p>StataHelp includes a multi-level caching mechanism to improve performance:</p> <ul> <li>Project-Level Cache: Saves help results to your project's temporary directory for quick access</li> <li>Global Cache: Stores help files in <code>~/.stata_mcp/help/</code> for reuse across projects</li> <li>Environment Control: Use <code>STATA_MCP_CACHE_HELP</code> and <code>STATA_MCP_SAVE_HELP</code> to control caching behavior</li> </ul>"},{"location":"core/stata/help/#command-validation","title":"Command Validation","text":"<p>Before executing a Stata command, you can use StataHelp to verify if the command exists:</p> <ul> <li>Checks if help documentation is available for a given command</li> <li>Helps prevent errors from typos or missing packages</li> <li>Useful for validating user input in automated workflows</li> </ul>"},{"location":"core/stata/help/#use-cases","title":"Use Cases","text":"<ul> <li>Command Verification: Check if a Stata command exists before execution</li> <li>Documentation Lookup: Retrieve help text for Stata commands programmatically</li> <li>Interactive Assistance: Provide in-context help in AI-powered Stata workflows</li> <li>Error Prevention: Validate commands before running them in scripts</li> </ul>"},{"location":"core/stata/help/#how-it-works","title":"How It Works","text":"<ol> <li>Cache Check: First checks project-level cache, then global cache (if enabled)</li> <li>Stata Query: If not cached, sends <code>help {command}</code> request to Stata CLI</li> <li>Documentation Retrieval: Stata searches its local documentation for the specified command</li> <li>Cache Storage: Saves the result to cache (if enabled)</li> <li>Result Return: Returns the help text for display or processing</li> </ol>"},{"location":"core/stata/help/#configuration","title":"Configuration","text":"<p>Control caching behavior with environment variables:</p> <pre><code># Enable global caching (default: false)\nexport STATA_MCP_CACHE_HELP=true\n\n# Enable project-level saving (default: true)\nexport STATA_MCP_SAVE_HELP=true\n</code></pre>"},{"location":"core/stata/help/#limitations","title":"Limitations","text":"<ul> <li>Platform Support: Currently only works on macOS and Linux</li> <li>Local Documentation Only: Cannot access help for packages that are not installed locally</li> <li>No Internet Search: Does not perform online searches for missing commands</li> </ul>"},{"location":"core/stata/help/#file-locations","title":"File Locations","text":"<ul> <li>Global Cache Directory: <code>~/.stata_mcp/help/</code></li> <li>Project Cache Directory: <code>{project_tmp_dir}/</code> (usually in <code>stata-mcp-tmp/</code>)</li> </ul>"},{"location":"core/stata/package/","title":"Stata Package Installation","text":""},{"location":"core/stata/package/#overview","title":"Overview","text":"<p>The package installation module provides a convenient way to install Stata packages from the Statistical Software Components (SSC) archive. It supports automated package installation within Stata-MCP workflows, making it easy to extend Stata's functionality programmatically.</p>"},{"location":"core/stata/package/#key-features","title":"Key Features","text":""},{"location":"core/stata/package/#ssc-archive-integration","title":"SSC Archive Integration","text":"<p>Directly installs packages from the Boston College Statistical Software Components archive:</p> <ul> <li>Automatic Installation: Installs packages with a single command</li> <li>Dependency Handling: Stata's package manager handles dependencies automatically</li> <li>Version Management: Supports updating existing packages with the <code>replace</code> option</li> </ul>"},{"location":"core/stata/package/#cross-platform-support","title":"Cross-Platform Support","text":"<p>Works on all supported operating systems:</p> <ul> <li>Windows: Full support through Stata's batch execution mode</li> <li>macOS: Native support through Stata CLI</li> <li>Linux: Native support through Stata CLI</li> </ul>"},{"location":"core/stata/package/#installation-verification","title":"Installation Verification","text":"<p>The module provides built-in verification to ensure successful installation:</p> <ul> <li>Checks for installation success messages</li> <li>Handles already-installed packages gracefully</li> <li>Returns clear status messages for troubleshooting</li> </ul>"},{"location":"core/stata/package/#use-cases","title":"Use Cases","text":"<ul> <li>Automated Setup: Install required packages in automated research workflows</li> <li>Environment Initialization: Prepare Stata environments with necessary packages</li> <li>Missing Package Recovery: Automatically install packages when commands are not found</li> <li>CI/CD Pipelines: Set up consistent Stata environments in automated testing</li> </ul>"},{"location":"core/stata/package/#how-it-works","title":"How It Works","text":"<ol> <li>Command Construction: Builds the appropriate <code>ssc install {package}</code> command</li> <li>Stata Execution: Sends the installation command to Stata CLI</li> <li>Result Verification: Checks the output for success indicators</li> <li>Status Reporting: Returns the installation status and any messages</li> </ol>"},{"location":"core/stata/package/#installation-behavior","title":"Installation Behavior","text":"<p>By default, the installer uses the <code>replace</code> option:</p> <ul> <li>New Packages: Installs the package for the first time</li> <li>Existing Packages: Replaces with the latest version from SSC</li> <li>Up-to-Date Packages: Skips installation if already at the latest version</li> </ul>"},{"location":"core/stata/package/#common-packages","title":"Common Packages","text":"<p>Some frequently installed packages include:</p> <ul> <li><code>estout</code>: Regression and estimation tables</li> <li><code>outreg2</code>: Alternative regression table output</li> <li><code>coefplot</code>: Coefficient plots</li> <li><code>tabout</code>: Export tables to various formats</li> <li><code>graphexport</code>: Enhanced graph export options</li> </ul>"},{"location":"core/stata/package/#error-handling","title":"Error Handling","text":"<p>The module handles common installation scenarios:</p> <ul> <li>Package not found on SSC</li> <li>Network connectivity issues</li> <li>File permission problems</li> <li>Stata license limitations</li> </ul>"},{"location":"core/stata/package/#example-workflow","title":"Example Workflow","text":"<pre><code>// Install a package\nssc install estout\n\n// The module handles:\n// 1. Downloading from SSC\n// 2. Installing to your Stata ado directory\n// 3. Setting up help files\n// 4. Verifying installation\n</code></pre>"},{"location":"core/stata/package/#notes","title":"Notes","text":"<ul> <li>Requires internet connection for SSC access</li> <li>Installation speed depends on package size and network connection</li> <li>Some packages may have additional system requirements</li> <li>Always verify package functionality after installation</li> </ul>"},{"location":"mcp/resources/","title":"MCP.Resources","text":"<p>Stata-MCP provides MCP resources for accessing Stata documentation and help contents.</p>"},{"location":"mcp/resources/#help","title":"help","text":"<p>Platform Support: macOS and Linux only (Windows not supported)</p> <pre><code>@stata_mcp.resource(\n    uri=\"help://stata/{cmd}\",\n    name=\"help\",\n    description=\"Get help for a Stata command\"\n)\ndef help(cmd: str) -&gt; str:\n    ...\n</code></pre> <p>Resource URI: <code>help://stata/{cmd}</code></p> <p>Input Parameters: - <code>cmd</code>: Stata command name (required, e.g., \"regress\", \"describe\", \"xtset\", \"merge\")</p> <p>Return Structure: String containing Stata help text output. May include cache status prefix: - <code>\"Cached result for {cmd}\\n{help_text}\"</code> - Retrieved from cache - <code>\"Saved result for {cmd}\\n{help_text}\"</code> - Retrieved from project cache - <code>\"{help_text}\"</code> - Fresh result from Stata - <code>\"No help found for the command in Stata ado locally: {cmd}\"</code> - Command not found</p> <p>Operational Examples:</p> <pre><code># Regression commands\nhelp(\"regress\")\nhelp(\"logit\")\nhelp(\"probit\")\n\n# Panel data commands\nhelp(\"xtset\")\nhelp(\"xtreg\")\nhelp(\"xtmixed\")\n\n# Data management\nhelp(\"merge\")\nhelp(\"reshape\")\nhelp(\"collapse\")\n\n# Time series\nhelp(\"tsset\")\nhelp(\"arima\")\nhelp(\"varsoc\")\n</code></pre> <p>Implementation Architecture:</p> <p>The help resource implements a dual-registered pattern in the MCP framework, functioning as both a resource (URI-addressable via <code>help://stata/{cmd}</code>) and an executable tool. This dual registration enables flexible access patterns: clients can either invoke it as a standard tool or access it via the resource protocol.</p> <p>The <code>StataHelp</code> class manages help text retrieval with a three-tier caching strategy:</p> <ol> <li>Project-level Cache (<code>STATA_MCP_SAVE_HELP</code>, default: <code>true</code>):</li> <li>Stores help text in <code>stata-mcp-tmp/help__{cmd}.txt</code></li> <li>Persists across sessions within the project directory</li> <li> <p>Highest priority for retrieval</p> </li> <li> <p>Global Cache (<code>STATA_MCP_CACHE_HELP</code>, default: <code>false</code>):</p> </li> <li>Stores help text in <code>~/.statamcp/help/help__{cmd}.txt</code></li> <li>Shared across all projects</li> <li> <p>Secondary priority if project cache miss</p> </li> <li> <p>Live Stata Execution:</p> </li> <li>Invokes Stata CLI with <code>help {cmd}</code> command</li> <li>Captures stdout for return value</li> <li>Falls back to this tier when both caches miss</li> </ol> <p>Cache Invalidation: No automatic TTL-based expiration exists. Cache invalidation requires: - Manual deletion of cache files (<code>rm ~/.statamcp/help/help__{cmd}.txt</code>) - Setting environment variable <code>STATA_MCP_CACHE_HELP=false</code> to disable caching - Setting environment variable <code>STATA_MCP_SAVE_HELP=false</code> to disable project-level caching</p> <p>Error Detection: The help system detects command existence by comparing Stata output against a standard error message template:</p> <pre><code>help {cmd}\nhelp for {cmd} not found\ntry help contents or search {cmd}\n</code></pre> <p>If the output matches this pattern, the system raises an exception indicating the command is not found in locally installed ado-files. This behavior occurs after cache miss and before caching new results.</p> <p>Platform Considerations: - macOS/Linux: Full support with caching and live Stata execution - Windows: Not supported due to Stata CLI limitations on Windows platforms</p> <p>Performance Optimization: For frequently accessed commands (e.g., <code>regress</code>, <code>xtreg</code>), enable <code>STATA_MCP_CACHE_HELP=true</code> to avoid repeated Stata invocations. The first execution queries Stata (~50-200ms depending on Stata startup time), subsequent queries return from cache (~1-5ms file read).</p> <p>Usage Notes: - Help text language depends on the Stata installation locale - Multilingual support requires separate Stata installations or locale reconfiguration - Cache files are plain text UTF-8 encoded, allowing manual inspection or editing - The resource URI pattern <code>help://stata/{cmd}</code> enables programmatic access via MCP resource protocol</p> <p>Environment Variables:</p> Variable Default Description <code>STATA_MCP_CACHE_HELP</code> <code>false</code> Enable global caching at <code>~/.statamcp/help/</code> <code>STATA_MCP_SAVE_HELP</code> <code>true</code> Enable project-level caching at <code>stata-mcp-tmp/</code> <p>Integration with Tools: The help resource integrates with Stata-MCP tools in several workflows: - Pre-execution validation: Check command syntax before generating do-files - Error diagnosis: Understand error messages from Stata execution - Learning assistance: Provide contextual help during analysis sessions - Code completion: Suggest valid command options and syntax</p> <p>Example Workflow:</p> <pre><code># 1. Check if a command exists\nhelp_result = help(\"ivregress2\")\nif \"not found\" not in help_result:\n    # 2. Generate do-file using the command\n    write_dofile(\"ivregress2 y x1 x2, robust\")\n\n    # 3. Execute the do-file\n    stata_do(\"/path/to/do/file\")\n</code></pre>"},{"location":"mcp/tools/","title":"MCP.Tools","text":""},{"location":"mcp/tools/#get_data_info","title":"get_data_info","text":"<pre><code>def get_data_info(data_path: str | Path,\n                  vars_list: List[str] | None = None,\n                  encoding: str = \"utf-8\") -&gt; str:\n    ...\n</code></pre> <p>Input Parameters: - <code>data_path</code>: Absolute filesystem path or URL to data file (required) - <code>vars_list</code>: Optional variable subset specification for selective analysis (default: null, all variables) - <code>encoding</code>: Character encoding for text-based formats (default: UTF-8, ignored for .dta)</p> <p>Return Structure: Serialized JSON string containing multi-layered metadata:</p> <pre><code>{\n  \"overview\": {\"source\": &lt;path&gt;, \"obs\": &lt;int&gt;, \"var_numbers\": &lt;int&gt;, \"var_list\": [&lt;array&gt;]},\n  \"info_config\": {\"metrics\": [&lt;array&gt;], \"max_display\": &lt;int&gt;, \"decimal_places\": &lt;int&gt;},\n  \"vars_detail\": {&lt;variable_name&gt;: {\"var\": &lt;str&gt;, \"type\": &lt;str&gt;, \"summary\": {...}}},\n  \"saved_path\": &lt;cache_file_path&gt;\n}\n</code></pre> <p>Operational Examples:</p> <pre><code># Local file analysis\nget_data_info(\"/data/econometrics/survey.dta\")\nget_data_info(\"~/Documents/exports/quarterly.csv\", vars_list=[\"gdp\", \"inflation\", \"unemployment\"])\n\n# Remote data ingestion\nget_data_info(\"https://repository.org/datasets/panel_data.xlsx\")\n\n# Encoded source handling\nget_data_info(\"/data/legacy/latin1_data.csv\", encoding=\"latin1\")\n</code></pre> <p>Implementation Architecture: The tool operates through a multi-layered abstraction cascade. At the foundation lies a polymorphic class hierarchy where <code>DataInfoBase</code> defines the abstract interface for format-specific handlers (<code>DtaDataInfo</code>, <code>CsvDataInfo</code>, <code>ExcelDataInfo</code>). Content integrity verification employs MD5 hashing with configurable suffix length for cache identification. Configuration propagation follows a precedence chain: runtime parameters override environment variables (<code>STATA_MCP_DATA_INFO_DECIMAL_PLACES</code>, <code>STATA_MCP_DATA_INFO_STRING_KEEP_NUMBER</code>), which in turn override TOML-based configuration at <code>~/.statamcp/config.toml</code>.</p> <p>Statistical computation leverages pandas DataFrame operations with NumPy backend. The metrics system implements a configurable computation pipeline where default metrics (<code>obs</code>, <code>mean</code>, <code>stderr</code>, <code>min</code>, <code>max</code>) can be extended through configuration to include quartiles (<code>q1</code>, <code>q3</code>) and distribution shape measures (<code>skewness</code>, <code>kurtosis</code>). Type dispatch separates string variables (observation counting with unique value sampling under <code>max_display</code> threshold) from numeric variables (central tendency, dispersion, and distribution shape computation with <code>decimal_places</code> precision rounding).</p> <p>Caching strategy employs content-addressable storage where hash computation determines cache file naming: <code>data_info__&lt;name&gt;_&lt;ext&gt;__hash_&lt;suffix&gt;.json</code>. Cache resolution occurs at invocation time, with automatic regeneration on content hash divergence. The cache directory defaults to <code>~/.statamcp/.cache/</code> but can be overridden to project-specific <code>stata-mcp-tmp/</code> locations through the <code>cache_dir</code> parameter.</p>"},{"location":"mcp/tools/#stata_do","title":"stata_do","text":"<pre><code>def stata_do(dofile_path: str,\n             log_file_name: str | None = None,\n             is_read_log: bool = True) -&gt; Dict[str, Union[str, None]]:\n    ...\n</code></pre> <p>Input Parameters: - <code>dofile_path</code>: Absolute or relative path to target .do file (required) - <code>log_file_name</code>: Custom log filename without timestamp (optional, auto-generated if null) - <code>is_read_log</code>: Boolean flag for log content retrieval (default: true)</p> <p>Return Structure: Dictionary containing execution metadata and optional log payload:</p> <pre><code>{\n  \"log_file_path\": \"&lt;absolute_path_to_stata_log&gt;\",\n  \"log_content\": \"&lt;full_log_text_or_'Not_read_log'&gt;\"\n}\n</code></pre> <p>Error condition returns: <code>{\"error\": \"&lt;exception_message&gt;\"}</code></p> <p>Operational Examples:</p> <pre><code># Standard execution with log retrieval\nstata_do(\"/Users/project/stata-mcp-dofile/20250104153045.do\")\n\n# Custom log naming\nstata_do(\"~/analysis/regression_pipeline.do\", log_file_name=\"quarterly_results\")\n\n# Execution without log reading\nstata_do(\"/tmp/estimation.do\", is_read_log=False)\n</code></pre> <p>Implementation Architecture: The tool encapsulates the <code>StataDo</code> executor class which implements platform-specific command invocation strategies. Cross-platform abstraction abstracts Stata executable location through the <code>StataFinder</code> class: macOS probes <code>/Applications/Stata/</code> hierarchy, Windows interrogates Program Files registry, and Linux queries system PATH for <code>stata-mp</code>. The execution pipeline involves do-file staging, Stata CLI invocation with <code>-b</code> batch mode flag, log file redirection, and exit code monitoring.</p> <p>Log file management operates within the <code>stata-mcp-log/</code> directory structure with automatic timestamp generation when <code>log_file_name</code> is omitted. The executor implements differential log handling based on <code>is_read_log</code> flag: when enabled, performs file read operation and returns content; when disabled, returns placeholder string to minimize I/O overhead.</p> <p>Exception handling categorizes failures into three tiers: <code>FileNotFoundError</code> for missing do-file artifacts, <code>RuntimeError</code> for Stata execution failures or log generation issues, and <code>PermissionError</code> for insufficient execution or write permissions. Error conditions return dictionary with <code>\"error\"</code> key rather than raising exceptions to maintain MCP protocol compatibility.</p>"},{"location":"mcp/tools/#write_dofile","title":"write_dofile","text":"<pre><code>def write_dofile(content: str, \n                 encoding: str | None = None) -&gt; str:\n    ...\n</code></pre> <p>Input Parameters: - <code>content</code>: Stata command sequence to persist (required) - <code>encoding</code>: Character encoding for file output (optional, defaults to UTF-8)</p> <p>Return Structure: String containing absolute POSIX-compliant path to generated do-file</p> <p>Operational Examples:</p> <pre><code># Basic regression analysis\nwrite_dofile(\"\"\"\nuse \"/data/survey.dta\", clear\nregress income age education experience\noutreg2 using \"`output_path'/results.doc\", replace\n\"\"\")\n\n# Time series analysis with encoding specification\nwrite_dofile(\"\"\"\ntsset date\narima gdp, ar(1) ma(1)\npredict forecast\n\"\"\", encoding=\"latin1\")\n\n# Data transformation pipeline\nwrite_dofile(\"\"\"\ngen log_gdp = ln(gdp)\ngen diff_income = d(income)\nxtset country_id year\nxtreg diff_income log_gdp, fe\n\"\"\")\n</code></pre> <p>Implementation Architecture: The tool implements atomic file creation within the <code>stata-mcp-dofile/</code> directory hierarchy. File naming employs ISO 8601 basic format timestamp generation (<code>YYYYMMDDHHMMSS.do</code>) ensuring temporal uniqueness and chronological sorting. The write operation utilizes Python's built-in <code>open()</code> function with mode <code>\"w\"</code> and specified encoding parameter, performing implicit file creation and truncation for atomic write semantics.</p> <p>Integration with output redirection commands (<code>outreg2</code>, <code>esttab</code>) requires coordination with the <code>results_doc_path</code> prompt to establish output directory paths prior to do-file generation. This separation of concerns enables deterministic output path management across multiple Stata execution cycles.</p> <p>The tool does not perform syntactic validation or semantic analysis of the Stata code content. Code correctness, command sequencing, and macro expansion validity remain the responsibility of the calling context. Error handling wraps file I/O operations in try-except blocks with structured logging for success/failure tracking.</p>"},{"location":"mcp/tools/#append_dofile","title":"append_dofile","text":"<pre><code>def append_dofile(original_dofile_path: str,\n                  content: str,\n                  encoding: str | None = None) -&gt; str:\n    ...\n</code></pre> <p>Input Parameters: - <code>original_dofile_path</code>: Source file path for content extension (may be invalid or empty) - <code>content</code>: Stata code to append (required) - <code>encoding</code>: Character encoding (optional, defaults to UTF-8)</p> <p>Return Structure: String containing absolute path to new do-file (either modified copy or newly created artifact)</p> <p>Operational Examples:</p> <pre><code># Extend existing analysis\nappend_dofile(\n    \"/Users/project/stata-mcp-dofile/base_analysis.do\",\n    \"xtreg y x1 x2, fe robust\"\n)\n\n# Fail-safe creation when source missing\nappend_dofile(\n    \"/nonexistent/path.do\",\n    \"regress y x\"\n)\n# Returns new file path with provided content\n\n# Code composition for iterative analysis\nappend_dofile(\n    previous_dofile_path,\n    \"\"\"\npredict residuals, residuals\nsummarize residuals\n\"\"\"\n)\n</code></pre> <p>Implementation Architecture: The tool implements a fail-safe composition strategy through three-phase operation: validation phase checks <code>original_dofile_path</code> existence and accessibility via <code>Path.exists()</code> probe; composition phase performs conditional content assembly where valid source files trigger read operations followed by concatenation, while invalid paths trigger new file creation; persistence phase writes combined content to a new timestamped artifact in <code>stata-mcp-dofile/</code> hierarchy.</p> <p>Critical design characteristic: source files remain unmodified. All composition operations create new artifacts with fresh timestamps, ensuring source immutability and preserving provenance. Newline integrity maintenance examines source file termination; if source content lacks trailing newline, separator insertion occurs before content append.</p> <p>The tool does not perform syntactic coherence validation between original and appended content. Macro variable scoping, temporary variable naming conflicts, and command sequence validity require manual coordination by the caller. Similar to <code>write_dofile</code>, output redirection path management necessitates prior <code>results_doc_path</code> invocation for commands requiring explicit output file specification.</p> <p>Platform-specific path resolution utilizes <code>pathlib.Path</code> for cross-platform compatibility. File read operations employ specified encoding parameter with fallback to UTF-8 default. Error handling wraps I/O operations with silent failure on read errors, treating read exceptions equivalent to missing source files.</p>"},{"location":"mcp/tools/#mk_dir","title":"mk_dir","text":"<pre><code>def mk_dir(path: str) -&gt; bool:\n    ...\n</code></pre> <p>Input Parameters: - <code>path</code>: Directory path specification (string, required, non-empty)</p> <p>Return Structure: Boolean indicating directory existence verification post-creation (true: exists, false: creation failed)</p> <p>Operational Examples:</p> <pre><code># Single directory creation\nmk_dir(\"/Users/project/outputs\")\n# Returns: True\n\n# Recursive hierarchy creation\nmk_dir(\"~/analysis/2025/q1/january\")\n# Creates: analysis/, analysis/2025/, analysis/2025/q1/, analysis/2025/q1/january/\n\n# Cross-platform paths\nmk_dir(\"C:\\\\Users\\\\project\\\\data\")  # Windows\nmk_dir(\"/home/user/analysis\")       # Unix\n</code></pre> <p>Implementation Architecture: The tool implements secure directory creation through the <code>pathvalidate</code> library's <code>sanitize_filepath()</code> function with platform-specific validation. Sanitization phase removes directory traversal sequences, normalizes path separators, and validates character encoding. Path resolution converts sanitized input to absolute form via <code>Path.resolve()</code>, eliminating symbolic links and relative path components.</p> <p>Directory creation employs <code>Path.mkdir()</code> with parameters <code>mode=0o755</code> (rwxr-xr-x: owner read/write/execute, group/others read/execute), <code>exist_ok=True</code> (idempotent operation), and <code>parents=True</code> (recursive creation). Permission configuration follows Unix filesystem conventions with read/execute for group and others enabling directory traversal and listing.</p> <p>Exception hierarchy provides granular failure diagnostics: <code>ValueError</code> raised for invalid path detection via <code>ValidationError</code> from sanitization phase; <code>PermissionError</code> raised for insufficient directory creation permissions detected by OS; <code>OSError</code> raised for filesystem-level failures (disk full, quota exceeded, readonly filesystem). All exceptions propagate to caller with descriptive messages.</p> <p>Post-creation verification performs boolean existence check via <code>Path.exists()</code> combined with <code>Path.is_dir()</code> to confirm successful directory creation and differentiate between directories and files with identical names.</p>"},{"location":"mcp/tools/#load_figure","title":"load_figure","text":"<pre><code>def load_figure(figure_path: str) -&gt; Image:\n    ...\n</code></pre> <p>Input Parameters: - <code>figure_path</code>: Absolute path to image file (required)</p> <p>Return Structure: FastMCP <code>Image</code> object containing image data for MCP transport and display</p> <p>Operational Examples:</p> <pre><code># Load Stata-generated graph\nload_figure(\"/Users/project/exports/regression_results.png\")\n\n# Load exported figure\nload_figure(\"~/analysis/timeseries_plot.jpg\")\n</code></pre> <p>Implementation Architecture: The tool implements image asset loading from the local filesystem using FastMCP's native <code>Image</code> class wrapper. Path validation checks file existence via <code>Path.exists()</code> probe; missing assets trigger <code>FileNotFoundError</code> exception with descriptive message. Successful invocations construct <code>Image</code> object with file path as initialization parameter, enabling automatic file reading and MIME type detection by the underlying MCP framework.</p> <p>Supported formats depend on FastMCP implementation but typically include PNG (Portable Network Graphics) and JPEG (Joint Photographic Experts Group). The tool performs no format validation or conversion; unsupported formats generate errors during Image object construction or transport phase.</p> <p>Error logging writes structured messages to logging infrastructure prior to exception propagation, enabling audit trail of failed load attempts. The tool performs no image processing, resizing, or format conversion\u2014operations occur at display/rendering time by the MCP client application.</p>"},{"location":"mcp/tools/#read_file","title":"read_file","text":"<pre><code>def read_file(file_path: str, \n              encoding: str = \"utf-8\") -&gt; str:\n    ...\n</code></pre> <p>Input Parameters: - <code>file_path</code>: Absolute path to target file (required) - <code>encoding</code>: Character encoding for text decoding (optional, defaults to UTF-8)</p> <p>Return Structure: String containing complete file content decoded with specified encoding</p> <p>Operational Examples:</p> <pre><code># Read Stata log file\nread_file(\"/Users/project/stata-mcp-log/20250104153045.log\")\n\n# Read configuration with encoding\nread_file(\"~/.statamcp/config.toml\", encoding=\"utf-8\")\n\n# Read exported results\nread_file(\"~/analysis/tables/regression_results.txt\")\n</code></pre> <p>Implementation Architecture: The tool implements generic file reading via Python's built-in <code>open()</code> function with mode <code>\"r\"</code> and specified encoding parameter. Path validation checks file existence through <code>Path.exists()</code>; missing files raise <code>FileNotFoundError</code> with descriptive message including invalid path. File reading utilizes context manager (<code>with</code> statement) for automatic file handle closure and resource cleanup.</p> <p>Content reading performs single operation <code>file.read()</code> retrieving entire file content into memory as string. For large files exceeding available memory, this approach triggers <code>MemoryError</code>; however, typical use cases involve log files, configuration files, and result tables within reasonable size bounds.</p> <p>Error handling categorizes failures: <code>FileNotFoundError</code> for non-existent paths, <code>IOError</code> for I/O operation failures (permission denied, disk read error, filesystem corruption), and <code>UnicodeDecodeError</code> for encoding mismatches (though not explicitly caught, propagates to caller with encoding information). Success operations log structured messages including file path for audit trail.</p>"},{"location":"mcp/tools/#ado_package_install","title":"ado_package_install","text":"<pre><code>def ado_package_install(package: str,\n                        source: str = \"ssc\",\n                        is_replace: bool = True,\n                        package_source_from: str | None = None) -&gt; str:\n    ...\n</code></pre> <p>Input Parameters: - <code>package</code>: Package identifier (required)   - SSC: package name (e.g., \"outreg2\")   - GitHub: \"username/reponame\" format (e.g., \"sepinetam/texiv\")   - net: package name with <code>package_source_from</code> specifying source - <code>source</code>: Distribution source (optional, default: \"ssc\")   - Options: \"ssc\", \"github\", \"net\" - <code>is_replace</code>: Force replacement flag (optional, default: true) - <code>package_source_from</code>: Source URL or directory for 'net' installations (optional)</p> <p>Return Structure: String containing complete Stata execution log from installation operation</p> <p>Operational Examples:</p> <pre><code># SSC package installation\nado_package_install(\"outreg2\", source=\"ssc\")\n\n# GitHub package installation\nado_package_install(\"sepinetam/texiv\", source=\"github\")\n\n# Network installation\nado_package_install(\"custompkg\", source=\"net\", package_source_from=\"https://example.com/stata/\")\n\n# Force reinstall\nado_package_install(\"estout\", source=\"ssc\", is_replace=True)\n</code></pre> <p>Implementation Architecture: The tool implements platform-divergent installation strategies. Unix systems (macOS/Linux) execute through specialized installer classes inheriting from base installer interface: <code>SSC_Install</code> invokes <code>ssc install &lt;package&gt;, replace</code> via Stata CLI; <code>GITHUB_Install</code> executes <code>github install &lt;username/reponame&gt;, replace</code>; <code>NET_Install</code> runs <code>net install &lt;package&gt; from(&lt;source&gt;), replace</code>. Windows systems bypass direct installation, instead generating temporary do-file via <code>write_dofile</code> and delegating to <code>stata_do</code> execution.</p> <p>Installation verification occurs through message parsing where installer classes examine Stata output for success indicators. The <code>check_installed_from_msg()</code> method performs regex or substring matching to identify successful installation patterns. Failed installations trigger error logging with full message capture via debug-level logging.</p> <p>Performance considerations advise against unnecessary invocations due to network latency, repository lookup overhead, and redundant installation attempts when packages already exist in Stata's ado directory. The tool implements no local installation cache\u2014each invocation queries remote repositories or filesystem.</p>"},{"location":"mcp/tools/#help","title":"help","text":"<p>macOS and Linux only</p> <pre><code>def help(cmd: str) -&gt; str:\n    ...\n</code></pre> <p>Input Parameters: - <code>cmd</code>: Stata command name (required, e.g., \"regress\", \"describe\", \"xtset\")</p> <p>Return Structure: String containing Stata help text output with optional cache status prefix (e.g., \"Cached result for regress: ...\")</p> <p>Operational Examples:</p> <pre><code># Regression command help\nhelp(\"regress\")\n\n# Panel data commands\nhelp(\"xtset\")\nhelp(\"xtreg\")\n\n# Data management\nhelp(\"merge\")\nhelp(\"reshape\")\n</code></pre> <p>Implementation Architecture: The tool implements Stata command documentation retrieval through CLI invocation with caching layer. Documentation requests execute Stata in batch mode with <code>help &lt;cmd&gt;</code> command, capturing stdout for return value. The <code>StataHelp</code> class manages invocation through platform-specific Stata CLI paths detected by <code>StataFinder</code>.</p> <p>Caching architecture maintains help text cache at <code>~/.statamcp/help/</code> directory with file-based storage keyed by command name. Cache behavior controllable via environment variables: <code>STATA_MCP_CACHE_HELP</code> (default: true) enables/disables caching; <code>STATA_MCP_SAVE_HELP</code> controls cache persistence. Cached results include prefix message indicating cache status: \"Cached result for {cmd}: ...\" versus live help text.</p> <p>Dual decoration pattern registers tool as both MCP resource and executable function. Resource URI pattern <code>help://stata/{cmd}</code> enables URI-based access through MCP resource protocol, while function decorator <code>@stata_mcp.tool()</code> enables direct invocation. This dual registration provides flexible access patterns for different MCP client implementations.</p> <p>Cache invalidation requires manual deletion of cache files or environment variable configuration; no TTL-based expiration exists. Help text language depends on Stata installation locale; multilingual support requires separate Stata installations or locale reconfiguration.</p>"}]}